<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《深入理解 Babel》 · 刘远洋</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="manifest" href="/deep-in-babel/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="Just playing around">
    <meta property="og:url" content="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/">
    <meta property="og:site_name" content="《深入理解 Babel》 · 刘远洋">
    <meta property="og:description" content="Babel 的核心之一就是其转译模块，包括 babel-core、babel-parser 等。Babel 的转译过程分为&quot;解析/转换/生成&quot;三步。 转译环节 操作 功能 --- --- --- 解析 词法分析 生成标记数组（tokens） 语法分析 根据 tokens 数组生成源码的树形结构，即抽象语法树 语义分析 向抽象语法树补充源码的语义信息，如作用域">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="《深入理解 Babel》 · 刘远洋">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/deep-in-babel/assets/css/0.styles.2e317060.css" as="style"><link rel="preload" href="/deep-in-babel/assets/js/app.0ba590d3.js" as="script"><link rel="preload" href="/deep-in-babel/assets/js/vendors~layout-Layout.f8963aab.js" as="script"><link rel="preload" href="/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.ebefd1c7.js" as="script"><link rel="preload" href="/deep-in-babel/assets/js/page--6ea6aa74.9343547a.js" as="script"><link rel="preload" href="/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.33005620.js" as="script"><link rel="prefetch" href="/deep-in-babel/assets/js/22.6353f00e.js"><link rel="prefetch" href="/deep-in-babel/assets/js/layout-Blog.b0c6dcb7.js"><link rel="prefetch" href="/deep-in-babel/assets/js/layout-Layout.54347a9b.js"><link rel="prefetch" href="/deep-in-babel/assets/js/layout-NotFound.846facba.js"><link rel="prefetch" href="/deep-in-babel/assets/js/layout-Slide.88fa1023.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--4c0dc106.ac329b7a.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--4fdeacc4.e9d136fa.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--584954b8.6ac5374d.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--5e0b8312.34d20a66.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--6723acaa.073315bf.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--8fcba694.e2bc50aa.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--9bf3e428.c95018ed.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--aec4dcea.e658a3e2.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--c3b426fa.a50170d6.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page--d99aed8e.9d83a20c.js"><link rel="prefetch" href="/deep-in-babel/assets/js/page-前言.eba0ee25.js"><link rel="prefetch" href="/deep-in-babel/assets/js/vendors~photo-swipe.e221f9da.js">
    <link rel="stylesheet" href="/deep-in-babel/assets/css/0.styles.2e317060.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/deep-in-babel/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">《深入理解 Babel》 · 刘远洋</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://mogonote.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Notely
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/hoperyy/deep-in-babel" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="https://mogonote.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Notely
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a rel="noopener noreferrer" href="https://github.com/hoperyy/deep-in-babel" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/deep-in-babel/00.%E5%89%8D%E8%A8%80/" class="sidebar-link">第 0 章 - 前言</a></li><li><a href="/deep-in-babel/01.%E6%A6%82%E8%BF%B0/" class="sidebar-link">第 1 章 - 概述</a></li><li><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/" aria-current="page" class="active sidebar-link">第 2 章 - 转译原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#解析目标" class="sidebar-link">解析目标</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#解析过程" class="sidebar-link">解析过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#词法单元" class="sidebar-link heading3">词法单元</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#代码逻辑" class="sidebar-link heading3">代码逻辑</a></li></ul></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#相关概念" class="sidebar-link">相关概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#标记-token" class="sidebar-link heading3">标记（token）</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#标识符-identifier" class="sidebar-link heading3">标识符（Identifier）</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#关键字和保留字" class="sidebar-link heading3">关键字和保留字</a></li></ul></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#词法分析过程" class="sidebar-link">词法分析过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第-1-步-扫描识别-token" class="sidebar-link heading3">第 1 步: 扫描识别 token</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第2步-标记-token" class="sidebar-link heading3">第2步: 标记 token</a></li></ul></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-的词法分析" class="sidebar-link">Babel 的词法分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-的词法单元" class="sidebar-link heading3">Babel 的词法单元</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-tokenizer-源码解析" class="sidebar-link heading3">Babel tokenizer 源码解析</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-定义的-token-类型" class="sidebar-link heading3">Babel 定义的 token 类型</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#词法错误" class="sidebar-link heading3">词法错误</a></li></ul></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#相关概念-2" class="sidebar-link">相关概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#抽象语法树和具象语法树" class="sidebar-link heading3">抽象语法树和具象语法树</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#语法分析器" class="sidebar-link heading3">语法分析器</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#上下文无关文法" class="sidebar-link heading3">上下文无关文法</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#生成-ast-的算法" class="sidebar-link heading3">生成 AST 的算法</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#引用消解" class="sidebar-link heading3">引用消解</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#左值和右值" class="sidebar-link heading3">左值和右值</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#属性计算" class="sidebar-link heading3">属性计算</a></li></ul></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#语法分析和语义分析过程" class="sidebar-link">语法分析和语义分析过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第1步-确定文法规则" class="sidebar-link heading3">第1步: 确定文法规则</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第2步-自顶向下分析" class="sidebar-link heading3">第2步: 自顶向下分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-的语法分析和语义分析" class="sidebar-link">Babel 的语法分析和语义分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#源码结构" class="sidebar-link heading3">源码结构</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#位置信息" class="sidebar-link heading3">位置信息</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#工具方法" class="sidebar-link heading3">工具方法</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#保留字识别" class="sidebar-link heading3">保留字识别</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#作用域处理-scope" class="sidebar-link heading3">作用域处理（scope）</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#语句处理-statement" class="sidebar-link heading3">语句处理（statement）</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#表达式处理-expression" class="sidebar-link heading3">表达式处理（expression）</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#左值处理-lval" class="sidebar-link heading3">左值处理（lval）</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#错误处理" class="sidebar-link heading3">错误处理</a></li><li class="sidebar-sub-header"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#特定语法开关" class="sidebar-link heading3">特定语法开关</a></li></ul></li></ul></li><li><a href="/deep-in-babel/03.Babel%E8%8A%82%E7%82%B9/" class="sidebar-link">第 3 章 - Babel 节点</a></li><li><a href="/deep-in-babel/04.Babel%E5%B7%A5%E5%85%B7%E9%9B%86/" class="sidebar-link">第 4 章 - Babel 工具集</a></li><li><a href="/deep-in-babel/05.Babel%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/" class="sidebar-link">第 5 章 - Babel 插件编写</a></li><li><a href="/deep-in-babel/06.Babel%E5%86%85%E7%BD%AEplugin/" class="sidebar-link">第 6 章 - Babel 内置 Plugin</a></li><li><a href="/deep-in-babel/07.Babel%E5%86%85%E7%BD%AEpreset/" class="sidebar-link">第 7 章 - Babel 内置 Preset</a></li><li><a href="/deep-in-babel/08.runtime/" class="sidebar-link">第 8 章 - runtime</a></li><li><a href="/deep-in-babel/09.Babel%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" class="sidebar-link">第 9 章 - Babel 项目管理</a></li><li><a href="/deep-in-babel/10.%E8%BD%AC%E8%AF%91%E5%99%A8%E5%AF%B9%E6%AF%94/" class="sidebar-link">第 10 章 - 转译器对比</a></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline"></span></h1> <div class="page-info"><!----> <!----><!----><!----><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 76 min</span> <meta property="timeRequired" content="PT76M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#解析目标" class="anchor-link heading2"><div>解析目标</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#解析过程" class="anchor-link heading2"><div>解析过程</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#词法单元" class="anchor-link heading3"><div>词法单元</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#代码逻辑" class="anchor-link heading3"><div>代码逻辑</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#相关概念" class="anchor-link heading2"><div>相关概念</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#标记-token" class="anchor-link heading3"><div>标记（token）</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#标识符-identifier" class="anchor-link heading3"><div>标识符（Identifier）</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#关键字和保留字" class="anchor-link heading3"><div>关键字和保留字</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#词法分析过程" class="anchor-link heading2"><div>词法分析过程</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第-1-步-扫描识别-token" class="anchor-link heading3"><div>第 1 步: 扫描识别 token</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第2步-标记-token" class="anchor-link heading3"><div>第2步: 标记 token</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-的词法分析" class="anchor-link heading2"><div>Babel 的词法分析</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-的词法单元" class="anchor-link heading3"><div>Babel 的词法单元</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-tokenizer-源码解析" class="anchor-link heading3"><div>Babel tokenizer 源码解析</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-定义的-token-类型" class="anchor-link heading3"><div>Babel 定义的 token 类型</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#词法错误" class="anchor-link heading3"><div>词法错误</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#相关概念-2" class="anchor-link heading2"><div>相关概念</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#抽象语法树和具象语法树" class="anchor-link heading3"><div>抽象语法树和具象语法树</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#语法分析器" class="anchor-link heading3"><div>语法分析器</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#上下文无关文法" class="anchor-link heading3"><div>上下文无关文法</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#生成-ast-的算法" class="anchor-link heading3"><div>生成 AST 的算法</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#引用消解" class="anchor-link heading3"><div>引用消解</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#左值和右值" class="anchor-link heading3"><div>左值和右值</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#属性计算" class="anchor-link heading3"><div>属性计算</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#语法分析和语义分析过程" class="anchor-link heading2"><div>语法分析和语义分析过程</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第1步-确定文法规则" class="anchor-link heading3"><div>第1步: 确定文法规则</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#第2步-自顶向下分析" class="anchor-link heading3"><div>第2步: 自顶向下分析</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#babel-的语法分析和语义分析" class="anchor-link heading2"><div>Babel 的语法分析和语义分析</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#源码结构" class="anchor-link heading3"><div>源码结构</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#位置信息" class="anchor-link heading3"><div>位置信息</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#工具方法" class="anchor-link heading3"><div>工具方法</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#保留字识别" class="anchor-link heading3"><div>保留字识别</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#作用域处理-scope" class="anchor-link heading3"><div>作用域处理（scope）</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#语句处理-statement" class="anchor-link heading3"><div>语句处理（statement）</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#表达式处理-expression" class="anchor-link heading3"><div>表达式处理（expression）</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#左值处理-lval" class="anchor-link heading3"><div>左值处理（lval）</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#错误处理" class="anchor-link heading3"><div>错误处理</div></a></li><li class="anchor"><a href="/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86/#特定语法开关" class="anchor-link heading3"><div>特定语法开关</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><p>Babel 的核心之一就是其转译模块，包括 <code>babel-core</code>、<code>babel-parser</code> 等。Babel 的转译过程分为&quot;解析/转换/生成&quot;三步。</p> <table><thead><tr><th>转译环节</th> <th>操作</th> <th>功能</th></tr></thead> <tbody><tr><td>解析</td> <td>词法分析</td> <td>生成标记数组（tokens）</td></tr> <tr><td></td> <td>语法分析</td> <td>根据 tokens 数组生成源码的树形结构，即抽象语法树</td></tr> <tr><td></td> <td>语义分析</td> <td>向抽象语法树补充源码的语义信息，如作用域、重复定义检查等</td></tr> <tr><td>转换</td> <td>借助 Babel 插件对抽象语法树进行转换</td> <td>生成目标抽象语法树</td></tr> <tr><td>生成</td> <td>根据抽象语法树对象，重新生成代码字符串</td> <td>声明目标代码字符串</td></tr></tbody></table> <p>本章主要分为两部分讲解 Babel 相关的转译原理，分别是&quot;理论知识&quot;和&quot;Babel的转译过程&quot;。阅读顺序建议先了解转译原理的理论知识。</p> <blockquote><p>《编译原理》本身是大学的计算机相关课程之一，Babel 用到的理论也是基于其中的部分原理，可惜笔者学过的知识早就还给老师了。</p></blockquote> <p>为了帮助开发者了解 Babel 的基本原理，Babel 官网推荐了一个项目: <code>the-super-tiny-compiler</code>，除去注释代码仅 200 行，可读性很好，建议阅读，作为了解 Babel 原理的前菜。</p> <h1 id="the-super-tiny-compiler"><a href="#the-super-tiny-compiler" class="header-anchor">#</a> <code>the-super-tiny-compiler</code></h1> <h2 id="解析目标"><a href="#解析目标" class="header-anchor">#</a> 解析目标</h2> <p><code>the-super-tiny-compiler</code> 项目解析的目标是将 lisp 风格的函数调用转换为 C 风格。</p> <p>假设有两个函数，<code>add</code> 和 <code>subtract</code>，那么它们的写法将会是下面这样:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>                LISP                      C

2 + 2          (add 2 2)                 add(2, 2)
4 - 2          (subtract 4 2)            subtract(4, 2)
2 + (4 - 2)    (add 2 (subtract 4 2))    add(2, subtract(4, 2))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="解析过程"><a href="#解析过程" class="header-anchor">#</a> 解析过程</h2> <h3 id="词法单元"><a href="#词法单元" class="header-anchor">#</a> 词法单元</h3> <p><code>the-super-tiny-compiler</code> 定义了如下词法单元:</p> <table><thead><tr><th>语素</th> <th>标记类型</th></tr></thead> <tbody><tr><td><code>(</code></td> <td><code>paren</code></td></tr> <tr><td><code>)</code></td> <td><code>paren</code></td></tr> <tr><td><code>/[0-9]/</code></td> <td><code>number</code></td></tr> <tr><td><code>/[a-z]/i</code></td> <td><code>name</code></td></tr></tbody></table> <p>其中，简略起见，空格没有作为输出的 <code>tokens</code> 中的一员；<code>name</code> 也仅限于字母组成，没有覆盖 <code>add3</code> 这种含字母和数字的情况。</p> <h3 id="代码逻辑"><a href="#代码逻辑" class="header-anchor">#</a> 代码逻辑</h3> <p><code>the-super-tiny-compiler</code> 定义了方法 <code>tokenizer(input: string): Array&lt;{ type: String; value: String }&gt;</code> 作为词法分析器。</p> <p>这个方法不到 100 行，整体运行流程如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">tokenizer</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// `current` 字符串扫描过程中指向当前位置的指针</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// `tokens` 数组，也是要返回的对象，数组项为各个 token 单元</span>
    <span class="token keyword">var</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 首先创建一个 `while` 循环， `current` 变量会在循环中自增</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 我们在这里储存了 `input` 中 `current` 位置的字符</span>
        <span class="token keyword">var</span> char <span class="token operator">=</span> input<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// token 类型: `paren`，左圆括号</span>
        <span class="token comment">// 检查一下是不是一个左圆括号</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">'('</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果是，那么我们 push 一个 type 为 `paren`，value 为左圆括号的对象。</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'paren'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'('</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 发现了一个 token，自增 `current`</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// token 类型: `paren`，右圆括号</span>
        <span class="token comment">// 然后我们检查是不是一个右圆括号。这里做的时候和之前一样: 检查右圆括号、加入新的 token、</span>
        <span class="token comment">// 自增 `current`，然后进入下一次循环。</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'paren'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">')'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 发现了一个 token，自增 `current`</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 过滤空格，空格对 token 而言是无意义的</span>
        <span class="token keyword">var</span> <span class="token constant">WHITESPACE</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">WHITESPACE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 自增 `current`</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// token 类型: `number`，数字</span>
        <span class="token comment">// 下一个 token 的类型是数字。它和之前的一个字符的 token 不同，因为数字可以由多个数字字符组成，</span>
        <span class="token comment">// 但是只能把它们识别为一个 token。</span>
        <span class="token comment">// </span>
        <span class="token comment">//   (add 123 456)</span>
        <span class="token comment">//        ^^^ ^^^</span>
        <span class="token comment">//        这里只有两个 token</span>
        <span class="token comment">//        </span>
        <span class="token comment">// 当遇到一个数字字符时，会进入判断逻辑</span>
        <span class="token keyword">var</span> <span class="token constant">NUMBERS</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[0-9]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建一个 `value` 字符串，记录数字字符串</span>
            <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

            <span class="token comment">// 进入子循环，直到遇到的字符不是数字字符为止，</span>
            <span class="token comment">// 将循环途中遇到的每个数字拼接到 `value` 字符串中，并且自增 `current`</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
                char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 然后将类型为 `number` 的 token 放入 `tokens` 数组中</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> value
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// token 类型: `name`，函数名</span>
        <span class="token comment">// 最后一种类型的 token 是 `name`。它由一系列的字母组成，在 lisp 语法中代表函数。</span>
        <span class="token comment">//</span>
        <span class="token comment">//   (add 2 4)</span>
        <span class="token comment">//    ^^^</span>
        <span class="token comment">//    Name token</span>
        <span class="token comment">//</span>
        <span class="token keyword">var</span> <span class="token constant">LETTERS</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-z]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

            <span class="token comment">// 进入子循环，直到遇到的字符不是字母为止。注意，这里没有考虑含有非字母的函数名写法。</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
                char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 添加一个类型为 `name` 的 token</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> value
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 最后如果没有匹配上任何类型的 token，则抛出一个错误。</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'I dont know what this character is: '</span> <span class="token operator">+</span> char<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 词法分析器的最后返回 tokens 数组。</span>
    <span class="token keyword">return</span> tokens<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><p><img src="https://cdn.mogonote.com/u/db66ce7d4df3fc7ee394c51573980745/1639580998478.png" alt="image.png"></p> <h1 id="词法分析"><a href="#词法分析" class="header-anchor">#</a> 词法分析</h1> <p><code>the-super-tiny-compiler</code> 项目里，用到了&quot;词法分析&quot;。</p> <p>词法分析（lexical analysis）是将字符序列转换为标记（token）的过程。进行词法分析的程序或函数叫做词法分析器（lexical analyzer，简称 lexer），也叫扫描器（scanner）。</p> <p>以英文句子 <code>&quot;today is comfortable.&quot;</code> 为例，词法分析用于这个句子中是否有不合格的&quot;单词&quot;，以及将&quot;单词&quot;进行分类，这个&quot;单词&quot;也就是标记（token）。</p> <h2 id="相关概念"><a href="#相关概念" class="header-anchor">#</a> 相关概念</h2> <h3 id="标记-token"><a href="#标记-token" class="header-anchor">#</a> 标记（token）</h3> <p>标记（<code>token</code>）是构成源码的最小单位。从输入的字符串流中生成标记的过程叫标记化（<code>tokenization</code>），在这个过程中，词法分析器也会对标记进行分类。</p> <p>标记（token）通常是一个对象，包括了&quot;种别码&quot;和&quot;属性值&quot;（<code>token&lt;种别码, 属性值&gt;</code>）。</p> <p>以 the-super-tiny-compiler 输出的 token 为例，&quot;种别码&quot;也就是 &quot;number/paren/name&quot; 等类型的描述，&quot;属性值&quot;（也就是 &quot;123&quot; 等值）。</p> <p>词法分析器通常不会关注标记之间的关系（这由语法分析器关注），比如，词法分析可以将括号识别为标记（<code>token</code>），但无法保证括号间是否匹配。</p> <p>在词法分析过程中，会将代码字符串解析为一个个扁平的不可分割的词法单元，比如:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这段代码被词法分析后，会分割为如下词法单元。</p> <table><thead><tr><th>属性值</th> <th>种别码</th></tr></thead> <tbody><tr><td><code>const</code></td> <td><code>const</code></td></tr> <tr><td><code>a</code></td> <td><code>name</code></td></tr> <tr><td><code>=</code></td> <td><code>eq</code></td></tr> <tr><td><code>1</code></td> <td><code>num</code></td></tr> <tr><td><code>;</code></td> <td><code>semi</code></td></tr></tbody></table> <blockquote><p>这里采用的是 Babel 内部定义的种别码，不是普遍标准。</p></blockquote> <p>语法分析器读取输入字符流、从中识别出语素、最后生成不同类型的标记。其间一旦发现无效标记，便会报错。</p> <p>https://tc39.es/ecma262/#prod-ReservedWord</p> <h3 id="标识符-identifier"><a href="#标识符-identifier" class="header-anchor">#</a> 标识符（Identifier）</h3> <p>标识符指的是变量、函数、属性的名字、函数的参数。</p> <p>标识符的书写规则: （规则是哪里来的？）</p> <ul><li><p>第一个字符必须是字母、下划线(<code>_</code>)或者是美元符号(<code>$</code>)，不能为数字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>name  √
_say  √
$hi   √
3name ×
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>第一个字符之后，可以是字母、下划线(<code>_</code>)或者是美元符号(<code>$</code>)、数字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>name1  √
n_ame  √
n$     √
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>不能将关键字、保留字用作标识符</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>name √
<span class="token keyword">function</span> ×
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>可以使用 Unicode 转义序列。例如，字符 <code>a</code> 可以使用&quot;<code>\u0061</code>&quot;表示</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>\u0061 = 1 √
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="关键字和保留字"><a href="#关键字和保留字" class="header-anchor">#</a> 关键字和保留字</h3> <ul><li><p>关键字</p> <p>关键字是 ECMA-262 规定的 JavaScript 语言内部使用的一组名称（或称为命令）。这些名称具有特定的用途。</p> <p>关键字首先是标识名（<code>IdentifierName</code>），同时具有语义（也就是在 JavaScript 中有特殊用途），比如 <code>if/while/async/await</code> 等。</p> <p>关键字不能作为标识符（<code>Identifier</code>），比如变量、标签和函数名，以下这些写法是错误的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token keyword">if</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> ×

<span class="token keyword">var</span> <span class="token keyword">while</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> ×

<span class="token keyword">function</span> <span class="token keyword">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> ×
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>保留字</p> <p>保留字是 ECMA-262 规定的 JavaScript 语言内部预备使用的一组名称（或称为命令）。这些名称目前还没有具体的用途，是为 JavaScript 升级版本预留备用的，建议用户不要使用。</p> <p>保留字从字面意思来看，就是&quot;未来的关键字&quot;，本身还不具有特殊含义，但将来是可能成为关键字的。</p> <p>保留字不能作为标识符（<code>Identifier</code>）。</p> <p>保留字分为无条件保留字和有条件保留字。无条件保留字指的是本身严格为保留字，没有任何条件，如 <code>if/while</code>；有条件保留字指的是在特定的上下文中才被视为保留字，比如 <code>await</code> 只是在 <code>async</code> 函数/模块中，才被视为保留字。</p></li> <li><p>关键字与保留字列举</p> <p>部分关键字同时也是保留字，部分并不是。有些关键词只在特定的上下文语义中被识别为保留字。</p> <table><thead><tr><th>名称</th> <th>是关键字</th> <th>是保留字</th></tr></thead> <tbody><tr><td><code>await</code></td> <td>×</td> <td>在 <code>async</code> 函数/模块中，才被视为保留字</td></tr> <tr><td><code>break</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>case</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>catch</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>class</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>const</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>continue</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>debugger</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>default</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>delete</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>do</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>else</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>enum</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>export</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>extends</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>false</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>finally</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>for</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>function</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>if</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>import</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>in</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>instanceof</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>new</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>null</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>return</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>super</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>switch</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>this</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>throw</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>true</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>try</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>typeof</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>var</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>void</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>while</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>with</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>yield</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>async</code></td> <td>√</td> <td>×</td></tr> <tr><td><code>abstract</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>double</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>goto</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>native</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>static</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>boolean</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>implements</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>package</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>byte</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>private</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>synchronized</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>char</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>extends</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>int</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>protected</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>throws</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>final</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>interface</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>public</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>transient</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>float</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>long</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>short</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>volatile</code></td> <td>×</td> <td>√</td></tr></tbody></table></li></ul> <h2 id="词法分析过程"><a href="#词法分析过程" class="header-anchor">#</a> 词法分析过程</h2> <p>总的来说，词法分析分为 2 个步骤: &quot;扫描、标记&quot;。</p> <h3 id="第-1-步-扫描识别-token"><a href="#第-1-步-扫描识别-token" class="header-anchor">#</a> 第 1 步: 扫描识别 token</h3> <p>扫描是词法分析的第一阶段。词法分析器会扫描代码字符串，将其分隔为一个个 token，同时也是边扫描边识别 token 的。</p> <p>这里涉及 2 个问题:</p> <ul><li><p>代码字符串是怎样被分隔为一个个 token 的？</p> <p>利用有限状态机。</p></li> <li><p>识别 token 的依据是什么？</p> <p>利用字符串匹配和正则表达式。</p></li></ul> <h4 id="有限状态机"><a href="#有限状态机" class="header-anchor">#</a> 有限状态机</h4> <ul><li><p>问题拆解</p> <p>有限状态机（Finite State Mechine），又称有限状态自动机，是表示有限个状态以及在这些状态之间的转移和动作等行为的数学模型。</p> <p>它有如下特征：</p> <blockquote><p>状态总数（state）是有限的。
任一时刻，只处在一种状态之中。
某种条件下，会从一种状态转变（transition）到另一种状态。</p></blockquote> <p>在词法分析中，扫描源码时，遇到不同的字符，会进入不同的&quot;状态&quot;，这个&quot;状态&quot;有标识符、操作符、数字、字符串等。整个源码的扫描过程就是不同&quot;状态&quot;的迁移过程。</p> <p>比如，待扫描的源码为: <code>height &gt;= 20</code>，我们自定义的状态转译过程:</p> <p><img src="https://cdn.mogonote.com/u/db66ce7d4df3fc7ee394c51573980745/1639462404880.png" alt="image.png"></p> <p>其中，涉及的状态有:</p> <ul><li>标识符: 标记为 <code>name</code>。第一个字符必须是字母，后面的字符可以是字母或数字</li> <li>比较操作符: 标记为 <code>largerthan</code>，就是 <code>&gt;=</code></li> <li>数字字面量: 标记为 <code>num</code>，全部由数字构成</li></ul> <p>对于 JavaScript 而言，很显然这些状态的定义不是很完整，比如&quot;数字字面量&quot;还可以包含小数点，我们自定义的状态定义里缺失了这一点，不过对于我们理解有限状态机已经足够了。</p> <p>并且，上图并不是真正的优先状态机的描述方式，正确的描述方式是:</p> <p><img src="https://cdn.mogonote.com/u/db66ce7d4df3fc7ee394c51573980745/1639462441547.png" alt="image.png"></p></li> <li><p>状态转移过程</p> <ul><li><p>空状态</p> <p>刚开始启动或从其他状态返回的默认空状态。</p></li> <li><p>标识符状态</p> <p>初始状态时，遇到的第一个字符是字母的话，会转移到&quot;标识符状态&quot;。</p> <p>然后，继续&quot;预扫描&quot;后续的字符。</p> <p>如果&quot;预扫描&quot;到的下一个字符是字母或数字，则存储该字符到 token 对象的 <code>value</code> 属性，并停留在&quot;标识符状态&quot;；</p> <p>如果&quot;预扫描&quot;到的下一个字符不是字母或数字，则回退到上一个字符（也就是&quot;回溯&quot;），记录当前 token 为&quot;标识符&quot;，并退回&quot;空状态&quot;。</p></li> <li><p>数字字面量状态</p> <p>空状态时，遇到的第一个字符是数字的话，会转译到&quot;数字字面量状态&quot;。</p> <p>然后，继续&quot;预扫描&quot;后续的字符。</p> <p>如果&quot;预扫描&quot;到的下一个字符是数字，则存储该字符到 token 对象的 <code>value</code> 属性，并停留在&quot;数字字面量状态&quot;；</p> <p>如果&quot;预扫描&quot;到的下一个字符不是数字，则回退到上一个字符（也就是&quot;回溯&quot;），记录当前 token 为&quot;数字字面量状态&quot;，并退回&quot;空状态&quot;。</p></li></ul></li> <li><p>回溯</p> <p>在描述状态转译过程时，提到了&quot;回溯&quot;。</p> <p>回溯法是一种暴力搜索法，采用“试错”的思想，它尝试分步的去解决一个问题。在分步解决问题的过程中，当它通过尝试发现，现有的分步答案不能得到有效的正确的解答的时候，它将取消上一步甚至是上几步的计算，再通过其它的可能的分步解答再次尝试寻找问题的答案。</p></li> <li><p>总结</p> <p>通过上述分析过程，可以看到，词法分析的过程，其实就是根据构造的有限状态自动机，通过回溯等方式，持续进行状态转移，从而解析出各个 <code>token</code>。</p> <p>例子中只是包含了 3 个状态的有限状态自动机，要构造一个强大的词法分析器，可以根据场景扩展状态数量。</p></li></ul> <h4 id="正则表达式"><a href="#正则表达式" class="header-anchor">#</a> 正则表达式</h4> <p>这里的&quot;正则表达式&quot;就是 JavaScript 中的正则表达式，在进行状态判断时，通常用正则表达式判断状态类型，比如上文中我们自定义的状态对应的正则如下:</p> <ul><li>标识符: <code>/[a-zA-Z]([a-zA-Z_]|[0-9])*/</code></li> <li>数字字面量: <code>/\d+/</code></li> <li>赋值操作符: <code>/=/</code></li></ul> <p>当然，也可以用字符串匹配来识别各类状态，词法分析器大量采用了正则表达式和字符串匹配进行状态识别。</p> <p>Babel 的词法分析器组合使用了正则表达式/字符串匹配（重度使用了 <code>charcodes</code> 这个 npm 包）进行状态识别，后文会详细介绍。</p> <h3 id="第2步-标记-token"><a href="#第2步-标记-token" class="header-anchor">#</a> 第2步: 标记 token</h3> <p>扫描器识别出可标记的字符序列后，会交由标记生成器处理，标记生成器处理的过程叫标记化（tokenization）。</p> <p>标记化处理时，会将输入字符串分割为标记、进而将标记进行分类。这样生成的标记会被用于语法分析。</p> <p>比如字符串: <code>The quick brown fox jumps over the lazy dog</code>。</p> <p>计算机并不知道这是以空格分隔的九个英语单词，只知道这是普通的 43 个字符构成的字符串。可以通过一定的方法（这里使用空格作为分隔符）将语素（这里即英语单词）从输入字符串中分割出来。分割后的结果用 XML 可以表示如下:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sentence</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>The<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>quick<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>brown<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>fox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>jumps<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>over<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>the<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>lazy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>dog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sentence</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>尽管在某些情况下需要手工编写词法分析器，一般情况下词法分析器都用自动化工具生成。</p> <p>TODO</p> <h2 id="babel-的词法分析"><a href="#babel-的词法分析" class="header-anchor">#</a> Babel 的词法分析</h2> <p>Babel 的词法分析模块定义在 <code>Tokenizer</code> 模块，对应的目录是 <code>babel/packages/babel-parser/src/tokenizer/</code>，并且，<code>Tokenizer</code> 会作为后续语法分析、语义分析的一个中间模块提供服务。</p> <h3 id="babel-的词法单元"><a href="#babel-的词法单元" class="header-anchor">#</a> Babel 的词法单元</h3> <p>Babel 的 <code>Tokenizer</code> 模块定义了基本的词法单元，并深度依赖了第三方模块 <code>charcodes</code> 辅助进行词法分析。</p> <ul><li><p>内置词法单元</p> <p>文件 <code>babel/packages/babel-parser/src/tokenizer/types.js</code> 列举了 Babel 支持的所有词法单元。</p> <table><thead><tr><th>语素</th> <th>Babel代码中的助记符</th> <th>简介</th> <th>分类</th></tr></thead> <tbody><tr><td><code>num</code></td> <td><code>num</code></td> <td>数字</td> <td></td></tr> <tr><td><code>bigint</code></td> <td><code>bigint</code></td> <td>用于表示大于 2^53 - 1 的整数</td> <td></td></tr> <tr><td><code>decimal</code></td> <td><code>decimal</code></td> <td>更语义化地表示数字，如 <code>1_000_000</code></td> <td></td></tr> <tr><td><code>regexp</code></td> <td><code>regexp</code></td> <td>正则</td> <td></td></tr> <tr><td><code>string</code></td> <td><code>string</code></td> <td>字符串</td> <td></td></tr> <tr><td><code>name</code></td> <td><code>name</code></td> <td>名称</td> <td></td></tr> <tr><td><code>eof</code></td> <td><code>eof</code></td> <td><code>end of file</code></td> <td></td></tr> <tr><td><code>bracketL</code></td> <td><code>bracketL</code></td> <td><code>[</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketHashL</code></td> <td><code>bracketHashL</code></td> <td><code>#[</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketBarL</code></td> <td><code>bracketBarL</code></td> <td><code>[\|</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketR</code></td> <td><code>bracketR</code></td> <td><code>]</code>字符</td> <td>标点符号</td></tr> <tr><td><code>bracketBarR</code></td> <td><code>bracketBarR</code></td> <td><code>\|]</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketR</code></td> <td><code>bracketR</code></td> <td><code>}</code>字符</td> <td>标点符号</td></tr> <tr><td><code>braceL</code></td> <td><code>braceL</code></td> <td><code>{</code>字符</td> <td>标点符号</td></tr> <tr><td><code>braceBarL</code></td> <td><code>braceBarL</code></td> <td><code>{\|</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>braceHashL</code></td> <td><code>braceHashL</code></td> <td><code>#{</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>braceR</code></td> <td><code>braceR</code></td> <td><code>}</code>字符</td> <td>标点符号</td></tr> <tr><td><code>braceBarR</code></td> <td><code>braceBarR</code></td> <td><code>\|}</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>parenL</code></td> <td><code>parenL</code></td> <td><code>(</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>parenR</code></td> <td><code>parenR</code></td> <td><code>)</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>comma</code></td> <td><code>comma</code></td> <td><code>,</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>semi</code></td> <td><code>semi</code></td> <td><code>;</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>colon</code></td> <td><code>colon</code></td> <td><code>:</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>doubleColon</code></td> <td><code>doubleColon</code></td> <td><code>::</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>dot</code></td> <td><code>dot</code></td> <td><code>.</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>question</code></td> <td><code>question</code></td> <td><code>?</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>questionDot</code></td> <td><code>questionDot</code></td> <td><code>?.</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>arrow</code></td> <td><code>arrow</code></td> <td><code>=&gt;</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>template</code></td> <td><code>template</code></td> <td><code>template</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>ellipsis</code></td> <td><code>ellipsis</code></td> <td><code>...</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>backQuote</code></td> <td><code>backQuote</code></td> <td>``` 字符</td> <td>标点符号</td></tr> <tr><td><code>dollarBraceL</code></td> <td><code>dollarBraceL</code></td> <td><code>${</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>at</code></td> <td></td> <td><code>at</code></td> <td><code>@</code> 字符</td></tr> <tr><td><code>hash</code></td> <td><code>hash</code></td> <td><code>#</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>interpreterDirective</code></td> <td><code>interpreterDirective</code></td> <td><code>#!</code> 字符</td> <td></td></tr> <tr><td><code>eq</code></td> <td><code>eq</code></td> <td><code>=</code>字符</td> <td>操作符</td></tr> <tr><td><code>assign</code></td> <td><code>assign</code></td> <td><code>_=</code> 字符</td> <td>操作符</td></tr> <tr><td><code>slashAssign</code></td> <td><code>slashAssign</code></td> <td><code>_=</code> 字符</td> <td>操作符</td></tr> <tr><td><code>incDec</code></td> <td><code>incDec</code></td> <td><code>++</code> / <code>--</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bang</code></td> <td><code>bang</code></td> <td><code>!</code> 字符</td> <td>操作符</td></tr> <tr><td><code>tilde</code></td> <td><code>tilde</code></td> <td><code>~</code> 字符</td> <td>操作符</td></tr> <tr><td><code>pipeline</code></td> <td><code>pipeline</code></td> <td><code>\|&gt;</code> 字符</td> <td>操作符</td></tr> <tr><td><code>nullishCoalescing</code></td> <td><code>nullishCoalescing</code></td> <td><code>??</code> 字符</td> <td>操作符</td></tr> <tr><td><code>logicalOR</code></td> <td><code>logicalOR</code></td> <td><code>\|\|</code> 字符</td> <td>操作符</td></tr> <tr><td><code>logicalAND</code></td> <td><code>logicalAND</code></td> <td><code>&amp;&amp;</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitwiseOR</code></td> <td><code>bitwiseOR</code></td> <td><code>\|</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitwiseXOR</code></td> <td><code>bitwiseXOR</code></td> <td><code>^</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitwiseAND</code></td> <td><code>bitwiseAND</code></td> <td><code>&amp;</code> 字符</td> <td>操作符</td></tr> <tr><td><code>equality</code></td> <td><code>equality</code></td> <td><code>==</code> / <code>!=</code> / <code>===</code> / <code>!==</code> 字符</td> <td>操作符</td></tr> <tr><td><code>relational</code></td> <td><code>relational</code></td> <td><code>&lt;</code> / <code>&gt;</code> / <code>&lt;=</code> / <code>&gt;=</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitShift</code></td> <td><code>bitShift</code></td> <td><code>&lt;&lt;</code> / <code>&gt;&gt;</code> / <code>&gt;&gt;&gt;</code>字符</td> <td>操作符</td></tr> <tr><td><code>plusMin</code></td> <td><code>plusMin</code></td> <td><code>+</code> / <code>-</code> 字符</td> <td>操作符</td></tr> <tr><td><code>modulo</code></td> <td><code>modulo</code></td> <td><code>%</code> 字符</td> <td>操作符</td></tr> <tr><td><code>star</code></td> <td><code>star</code></td> <td><code>*</code> 字符</td> <td>操作符</td></tr> <tr><td><code>slash</code></td> <td><code>slash</code></td> <td><code>/</code> 字符</td> <td>操作符</td></tr> <tr><td><code>exponent</code></td> <td><code>exponent</code></td> <td><code>**</code> 字符</td> <td>操作符</td></tr> <tr><td><code>break</code></td> <td><code>_break</code></td> <td><code>break</code> 字符</td> <td>关键词</td></tr> <tr><td><code>case</code></td> <td><code>_case</code></td> <td><code>case</code> 字符</td> <td>关键词</td></tr> <tr><td><code>catch</code></td> <td><code>_catch</code></td> <td><code>catch</code> 字符</td> <td>关键词</td></tr> <tr><td><code>continue</code></td> <td><code>_continue</code></td> <td><code>continue</code> 字符</td> <td>关键词</td></tr> <tr><td><code>debugger</code></td> <td><code>_debugger</code></td> <td><code>debugger</code> 字符</td> <td>关键词</td></tr> <tr><td><code>default</code></td> <td><code>_default</code></td> <td><code>default</code> 字符</td> <td>关键词</td></tr> <tr><td><code>do</code></td> <td><code>_do</code></td> <td><code>do</code>字符</td> <td>关键词</td></tr> <tr><td><code>else</code></td> <td><code>_else</code></td> <td><code>else</code>字符</td> <td>关键词</td></tr> <tr><td><code>finally</code></td> <td><code>_finally</code></td> <td><code>finally</code> 字符</td> <td>关键词</td></tr> <tr><td><code>for</code></td> <td><code>_for</code></td> <td><code>for</code>字符</td> <td>关键词</td></tr> <tr><td><code>function</code></td> <td><code>_function</code></td> <td><code>function</code> 字符</td> <td>关键词</td></tr> <tr><td><code>if</code></td> <td><code>_if</code></td> <td><code>if</code> 字符</td> <td>关键词</td></tr> <tr><td><code>return</code></td> <td><code>_return</code></td> <td><code>return</code> 字符</td> <td>关键词</td></tr> <tr><td><code>switch</code></td> <td><code>_switch</code></td> <td><code>switch</code> 字符</td> <td>关键词</td></tr> <tr><td><code>throw</code></td> <td><code>_throw</code></td> <td><code>throw</code> 字符</td> <td>关键词</td></tr> <tr><td><code>try</code></td> <td><code>_try</code></td> <td><code>try</code> 字符</td> <td>关键词</td></tr> <tr><td><code>var</code></td> <td><code>_var</code></td> <td><code>var</code> 字符</td> <td>关键词</td></tr> <tr><td><code>const</code></td> <td><code>_const</code></td> <td><code>const</code> 字符</td> <td>关键词</td></tr> <tr><td><code>while</code></td> <td><code>_while</code></td> <td><code>while</code> 字符</td> <td>关键词</td></tr> <tr><td><code>with</code></td> <td><code>_with</code></td> <td><code>with</code> 字符</td> <td>关键词</td></tr> <tr><td><code>new</code></td> <td><code>_new</code></td> <td><code>new</code> 字符</td> <td>关键词</td></tr> <tr><td><code>this</code></td> <td><code>_this</code></td> <td><code>this</code> 字符</td> <td>关键词</td></tr> <tr><td><code>super</code></td> <td><code>_super</code></td> <td><code>super</code> 字符</td> <td>关键词</td></tr> <tr><td><code>class</code></td> <td><code>_class</code></td> <td><code>class</code> 字符</td> <td>关键词</td></tr> <tr><td><code>extends</code></td> <td><code>_extends</code></td> <td><code>extends</code> 字符</td> <td>关键词</td></tr> <tr><td><code>export</code></td> <td><code>_export</code></td> <td><code>export</code> 字符</td> <td>关键词</td></tr> <tr><td><code>import</code></td> <td><code>_import</code></td> <td><code>import</code> 字符</td> <td>关键词</td></tr> <tr><td><code>null</code></td> <td><code>_null</code></td> <td><code>null</code> 字符</td> <td>关键词</td></tr> <tr><td><code>true</code></td> <td><code>_true</code></td> <td><code>true</code> 字符</td> <td>关键词</td></tr> <tr><td><code>false</code></td> <td><code>_false</code></td> <td><code>false</code> 字符</td> <td>关键词</td></tr> <tr><td><code>in</code></td> <td><code>_in</code></td> <td><code>in</code> 字符</td> <td>关键词</td></tr> <tr><td><code>instanceof</code></td> <td><code>_instanceof</code></td> <td><code>instanceof</code> 字符</td> <td>关键词</td></tr> <tr><td><code>typeof</code></td> <td><code>_typeof</code></td> <td><code>typeof</code> 字符</td> <td>关键词</td></tr> <tr><td><code>void</code></td> <td><code>_void</code></td> <td><code>void</code> 字符</td> <td>关键词</td></tr> <tr><td><code>delete</code></td> <td><code>_delete</code></td> <td><code>delete</code> 字符</td> <td>关键词</td></tr></tbody></table></li> <li><p>charcodes</p> <p>Babel 利用社区的 npm 包 <code>charcodes</code> 帮助进行词法单元的识别，<code>charcodes</code> 定义的词法单元如下:</p> <p>https://compart.com/en/unicode/U+2029</p> <table><thead><tr><th>charcodes 命名</th> <th>编码</th> <th>十进制数字</th> <th>说明</th></tr></thead> <tbody><tr><td><code>backSpace</code></td> <td><code>U+0008</code></td> <td>8</td> <td></td></tr> <tr><td><code>tab</code></td> <td><code>U+0009</code></td> <td>9</td> <td><code>\t</code></td></tr> <tr><td><code>lineFeed</code></td> <td><code>U+000A</code></td> <td>10</td> <td><code>\n</code></td></tr> <tr><td><code>carriageReturn</code></td> <td><code>U+000D</code></td> <td>13</td> <td><code>\r</code></td></tr> <tr><td><code>shiftOut</code></td> <td><code>U+000E</code></td> <td>14</td> <td></td></tr> <tr><td><code>space</code></td> <td><code>U+0020</code></td> <td>32</td> <td>空格</td></tr> <tr><td><code>exclamationMark</code></td> <td><code>U+0021</code></td> <td>33</td> <td><code>!</code></td></tr> <tr><td><code>quotationMark</code></td> <td><code>U+0022</code></td> <td>34</td> <td><code>&quot;</code></td></tr> <tr><td><code>numberSign</code></td> <td><code>U+0023</code></td> <td>35</td> <td><code>#</code></td></tr> <tr><td><code>dollarSign</code></td> <td><code>U+0024</code></td> <td>36</td> <td><code>$</code></td></tr> <tr><td><code>percentSign</code></td> <td><code>U+0025</code></td> <td>37</td> <td><code>%</code></td></tr> <tr><td><code>ampersand</code></td> <td><code>U+0026</code></td> <td>38</td> <td><code>&amp;</code></td></tr> <tr><td><code>apostrophe</code></td> <td><code>U+0027</code></td> <td>39</td> <td><code>'</code></td></tr> <tr><td><code>leftParenthesis</code></td> <td><code>U+0028</code></td> <td>40</td> <td><code>(</code></td></tr> <tr><td><code>rightParenthesis</code></td> <td><code>U+0029</code></td> <td>41</td> <td><code>)</code></td></tr> <tr><td><code>asterisk</code></td> <td><code>U+002A</code></td> <td>42</td> <td><code>*</code></td></tr> <tr><td><code>plusSign</code></td> <td><code>U+002B</code></td> <td>43</td> <td><code>+</code></td></tr> <tr><td><code>comma</code></td> <td><code>U+002C</code></td> <td>44</td> <td><code>,</code></td></tr> <tr><td><code>dash</code></td> <td><code>U+002D</code></td> <td>45</td> <td><code>-</code></td></tr> <tr><td><code>dot</code></td> <td><code>U+002E</code></td> <td>46</td> <td><code>.</code></td></tr> <tr><td><code>slash</code></td> <td><code>U+002F</code></td> <td>47</td> <td><code>/</code></td></tr> <tr><td><code>digit0</code></td> <td><code>U+0030</code></td> <td>48</td> <td><code>0</code></td></tr> <tr><td><code>digit1</code></td> <td><code>U+0031</code></td> <td>49</td> <td><code>1</code></td></tr> <tr><td><code>digit2</code></td> <td><code>U+0032</code></td> <td>50</td> <td><code>2</code></td></tr> <tr><td><code>digit3</code></td> <td><code>U+0033</code></td> <td>51</td> <td><code>3</code></td></tr> <tr><td><code>digit4</code></td> <td><code>U+0034</code></td> <td>52</td> <td><code>4</code></td></tr> <tr><td><code>digit5</code></td> <td><code>U+0035</code></td> <td>53</td> <td><code>5</code></td></tr> <tr><td><code>digit6</code></td> <td><code>U+0036</code></td> <td>54</td> <td><code>6</code></td></tr> <tr><td><code>digit7</code></td> <td><code>U+0037</code></td> <td>55</td> <td><code>7</code></td></tr> <tr><td><code>digit8</code></td> <td><code>U+0038</code></td> <td>56</td> <td><code>8</code></td></tr> <tr><td><code>digit9</code></td> <td><code>U+0039</code></td> <td>57</td> <td><code>9</code></td></tr> <tr><td><code>colon</code></td> <td><code>U+003A</code></td> <td>58</td> <td><code>:</code></td></tr> <tr><td><code>semicolon</code></td> <td><code>U+003B</code></td> <td>59</td> <td><code>\|</code></td></tr> <tr><td><code>lessThan</code></td> <td><code>U+003C</code></td> <td>60</td> <td><code>&lt;</code></td></tr> <tr><td><code>equalsTo</code></td> <td><code>U+003D</code></td> <td>61</td> <td><code>=</code></td></tr> <tr><td><code>greaterThan</code></td> <td><code>U+003E</code></td> <td>62</td> <td><code>&gt;</code></td></tr> <tr><td><code>questionMark</code></td> <td><code>U+003F</code></td> <td>63</td> <td><code>?</code></td></tr> <tr><td><code>atSign</code></td> <td><code>U+0040</code></td> <td>64</td> <td><code>@</code></td></tr> <tr><td><code>uppercaseA</code></td> <td><code>U+0041</code></td> <td>65</td> <td><code>A</code></td></tr> <tr><td><code>uppercaseB</code></td> <td><code>U+0042</code></td> <td>66</td> <td><code>B</code></td></tr> <tr><td><code>uppercaseC</code></td> <td><code>U+0043</code></td> <td>67</td> <td><code>C</code></td></tr> <tr><td><code>uppercaseD</code></td> <td><code>U+0044</code></td> <td>68</td> <td><code>D</code></td></tr> <tr><td><code>uppercaseE</code></td> <td><code>U+0045</code></td> <td>69</td> <td><code>E</code></td></tr> <tr><td><code>uppercaseF</code></td> <td><code>U+0046</code></td> <td>70</td> <td><code>F</code></td></tr> <tr><td><code>uppercaseG</code></td> <td><code>U+0047</code></td> <td>71</td> <td><code>G</code></td></tr> <tr><td><code>uppercaseH</code></td> <td><code>U+0048</code></td> <td>72</td> <td><code>H</code></td></tr> <tr><td><code>uppercaseI</code></td> <td><code>U+0049</code></td> <td>73</td> <td><code>I</code></td></tr> <tr><td><code>uppercaseJ</code></td> <td><code>U+004A</code></td> <td>74</td> <td><code>J</code></td></tr> <tr><td><code>uppercaseK</code></td> <td><code>U+004B</code></td> <td>75</td> <td><code>K</code></td></tr> <tr><td><code>uppercaseL</code></td> <td><code>U+004C</code></td> <td>76</td> <td><code>L</code></td></tr> <tr><td><code>uppercaseM</code></td> <td><code>U+004D</code></td> <td>77</td> <td><code>M</code></td></tr> <tr><td><code>uppercaseN</code></td> <td><code>U+004E</code></td> <td>78</td> <td><code>N</code></td></tr> <tr><td><code>uppercaseO</code></td> <td><code>U+004F</code></td> <td>79</td> <td><code>O</code></td></tr> <tr><td><code>uppercaseP</code></td> <td><code>U+0050</code></td> <td>80</td> <td><code>P</code></td></tr> <tr><td><code>uppercaseQ</code></td> <td><code>U+0051</code></td> <td>81</td> <td><code>Q</code></td></tr> <tr><td><code>uppercaseR</code></td> <td><code>U+0052</code></td> <td>82</td> <td><code>R</code></td></tr> <tr><td><code>uppercaseS</code></td> <td><code>U+0053</code></td> <td>83</td> <td><code>S</code></td></tr> <tr><td><code>uppercaseT</code></td> <td><code>U+0054</code></td> <td>84</td> <td><code>T</code></td></tr> <tr><td><code>uppercaseU</code></td> <td><code>U+0055</code></td> <td>85</td> <td><code>U</code></td></tr> <tr><td><code>uppercaseV</code></td> <td><code>U+0056</code></td> <td>86</td> <td><code>V</code></td></tr> <tr><td><code>uppercaseW</code></td> <td><code>U+0057</code></td> <td>87</td> <td><code>W</code></td></tr> <tr><td><code>uppercaseX</code></td> <td><code>U+0058</code></td> <td>88</td> <td><code>X</code></td></tr> <tr><td><code>uppercaseY</code></td> <td><code>U+0059</code></td> <td>89</td> <td><code>Y</code></td></tr> <tr><td><code>uppercaseZ</code></td> <td><code>U+005A</code></td> <td>90</td> <td><code>Z</code></td></tr> <tr><td><code>leftSquareBracket</code></td> <td><code>U+005B</code></td> <td>91</td> <td><code>[</code></td></tr> <tr><td><code>backslash</code></td> <td><code>U+005C</code></td> <td>92</td> <td><code>\</code></td></tr> <tr><td><code>rightSquareBracket</code></td> <td><code>U+005D</code></td> <td>93</td> <td><code>]</code></td></tr> <tr><td><code>caret</code></td> <td><code>U+005E</code></td> <td>94</td> <td><code>^</code></td></tr> <tr><td><code>underscore</code></td> <td><code>U+005F</code></td> <td>95</td> <td><code>_</code></td></tr> <tr><td><code>graveAccent</code></td> <td><code>U+0060</code></td> <td>96</td> <td>`</td></tr> <tr><td><code>lowercaseA</code></td> <td><code>U+0061</code></td> <td>97</td> <td><code>a</code></td></tr> <tr><td><code>lowercaseB</code></td> <td><code>U+0062</code></td> <td>98</td> <td><code>b</code></td></tr> <tr><td><code>lowercaseC</code></td> <td><code>U+0063</code></td> <td>99</td> <td><code>c</code></td></tr> <tr><td><code>lowercaseD</code></td> <td><code>U+0064</code></td> <td>100</td> <td><code>d</code></td></tr> <tr><td><code>lowercaseE</code></td> <td><code>U+0065</code></td> <td>101</td> <td><code>e</code></td></tr> <tr><td><code>lowercaseF</code></td> <td><code>U+0066</code></td> <td>102</td> <td><code>f</code></td></tr> <tr><td><code>lowercaseG</code></td> <td><code>U+0067</code></td> <td>103</td> <td><code>g</code></td></tr> <tr><td><code>lowercaseH</code></td> <td><code>U+0068</code></td> <td>104</td> <td><code>h</code></td></tr> <tr><td><code>lowercaseI</code></td> <td><code>U+0069</code></td> <td>105</td> <td><code>i</code></td></tr> <tr><td><code>lowercaseJ</code></td> <td><code>U+006A</code></td> <td>106</td> <td><code>j</code></td></tr> <tr><td><code>lowercaseK</code></td> <td><code>U+006B</code></td> <td>107</td> <td><code>k</code></td></tr> <tr><td><code>lowercaseL</code></td> <td><code>U+006C</code></td> <td>108</td> <td><code>l</code></td></tr> <tr><td><code>lowercaseM</code></td> <td><code>U+006D</code></td> <td>109</td> <td><code>m</code></td></tr> <tr><td><code>lowercaseN</code></td> <td><code>U+006E</code></td> <td>110</td> <td><code>n</code></td></tr> <tr><td><code>lowercaseO</code></td> <td><code>U+006F</code></td> <td>111</td> <td><code>o</code></td></tr> <tr><td><code>lowercaseP</code></td> <td><code>U+0070</code></td> <td>112</td> <td><code>p</code></td></tr> <tr><td><code>lowercaseQ</code></td> <td><code>U+0071</code></td> <td>113</td> <td><code>q</code></td></tr> <tr><td><code>lowercaseR</code></td> <td><code>U+0072</code></td> <td>114</td> <td><code>r</code></td></tr> <tr><td><code>lowercaseS</code></td> <td><code>U+0073</code></td> <td>115</td> <td><code>s</code></td></tr> <tr><td><code>lowercaseT</code></td> <td><code>U+0074</code></td> <td>116</td> <td><code>t</code></td></tr> <tr><td><code>lowercaseU</code></td> <td><code>U+0075</code></td> <td>117</td> <td><code>u</code></td></tr> <tr><td><code>lowercaseV</code></td> <td><code>U+0076</code></td> <td>118</td> <td><code>v</code></td></tr> <tr><td><code>lowercaseW</code></td> <td><code>U+0077</code></td> <td>119</td> <td><code>w</code></td></tr> <tr><td><code>lowercaseX</code></td> <td><code>U+0078</code></td> <td>120</td> <td><code>x</code></td></tr> <tr><td><code>lowercaseY</code></td> <td><code>U+0079</code></td> <td>121</td> <td><code>y</code></td></tr> <tr><td><code>lowercaseZ</code></td> <td><code>U+007A</code></td> <td>122</td> <td><code>z</code></td></tr> <tr><td><code>leftCurlyBrace</code></td> <td><code>U+007B</code></td> <td>123</td> <td><code>{</code></td></tr> <tr><td><code>verticalBar</code></td> <td><code>U+007C</code></td> <td>124</td> <td><code>\|</code></td></tr> <tr><td><code>rightCurlyBrace</code></td> <td><code>U+007D</code></td> <td>125</td> <td><code>}</code></td></tr> <tr><td><code>tilde</code></td> <td><code>U+007E</code></td> <td>126</td> <td><code>~</code></td></tr> <tr><td><code>nonBreakingSpace</code></td> <td><code>U+00A0</code></td> <td>160</td> <td>不换行空格</td></tr> <tr><td><code>oghamSpaceMark</code></td> <td><code>U+1680</code></td> <td>5760</td> <td><code></code></td></tr> <tr><td><code>lineSeparator</code></td> <td><code>U+2028</code></td> <td>8232</td> <td></td></tr> <tr><td><code>paragraphSeparator</code></td> <td><code>U+2029</code></td> <td>8233</td> <td></td></tr></tbody></table></li></ul> <h3 id="babel-tokenizer-源码解析"><a href="#babel-tokenizer-源码解析" class="header-anchor">#</a> Babel tokenizer 源码解析</h3> <h4 id="文件结构"><a href="#文件结构" class="header-anchor">#</a> 文件结构</h4> <p>Babel Tokenizer 的核心代码位于目录 <code>github/babel/packages/babel-parser/src/tokenizer/</code>，其中 <code>/tokenizer/index.js</code> 定义了 <code>Tokenizer</code> 类。</p> <p>文件结构:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>|-- babel-parser
    |-- src
        |-- tokenizer
            |-- context.js: 上下文对象 context，与 token 示例关联
            |-- index.js: 定义了 Tokenizer 类，包括各种 token 相关的处理方法和属性
            |-- state.js: 维护了当前 token 实例的状态信息
            |-- types.js: 维护了所有 token 类型
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="tokendizer-index-js-重点代码"><a href="#tokendizer-index-js-重点代码" class="header-anchor">#</a> tokendizer/index.js 重点代码</h4> <p>总体而言，tokendizer/index.js 中定义的 <code>Tokenizer</code> 类继承自 <code>PaserErrors</code> 对象，同时定义了关于 token 的各种操作方法和属性。</p> <ul><li><p><code>tokens: Array&lt;Token | N.Comment&gt; = [];</code></p> <p><code>token</code> 数组。数组项可以是 <code>Token</code> 类的实例或者是注释对象。</p></li> <li><p><code>nextToken()</code></p> <p>访问下一个 <code>token</code>。</p> <p>笔者在源码中添加了部分注释，便于理解。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> curContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">curContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果不保留空白符和注释，则跳过它们</span>
    <span class="token comment">// 一般情况下，均认为空格是可以忽略的，不需要识别为 token。有几种类型的 token 是例外:</span>
    <span class="token comment">// 1. `template`: 模板字符串中的空格是有意义的</span>
    <span class="token comment">// 2. jsx 中的 `expr`: `&lt;tag&gt;...&lt;/tag&gt;` 标签内的空格也是有意义的</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curContext<span class="token punctuation">.</span>preserveSpace<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">skipSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>

    <span class="token comment">// 记录访问开始的位置信息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isLookahead<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>startLoc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">curPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果目标访问位置超过了源码长度，则认为进入源码文件末尾，也就是 &quot;end-of-file&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>eof<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 区分是在读取 template 语法还是非 template 语法（数字、操作符等）</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>curContext <span class="token operator">===</span> ct<span class="token punctuation">.</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readTmplToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTokenFromCode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">codePointAtPos</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li> <li><p><code>lookahead()</code></p> <p>读取并返回下一个 <code>token</code> 对象。这里用到了简单的&quot;回溯&quot;写法，先保存当前 token 对象，再直接进入并获取下一个 token 对象，最后恢复为当前 token 对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">lookahead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> LookaheadState <span class="token punctuation">{</span>
    <span class="token comment">// 保留状态</span>
    <span class="token keyword">const</span> old <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个新的 token state</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createLookaheadState</span><span class="token punctuation">(</span>old<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 访问下一个 token</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isLookahead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isLookahead <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> curr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>

    <span class="token comment">// 恢复状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> old<span class="token punctuation">;</span>

    <span class="token comment">// 返回下一个 token</span>
    <span class="token keyword">return</span> curr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p><code>codePointAtPos()</code></p> <p>TODO</p></li></ul> <h3 id="babel-定义的-token-类型"><a href="#babel-定义的-token-类型" class="header-anchor">#</a> Babel 定义的 token 类型</h3> <p>词法文法: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Lexical_grammar
JavaScript 参考: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference</p> <p>在介绍词法分析时提到过一个案例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这段代码被词法分析后，会分割为如下词法单元。</p> <table><thead><tr><th>词法单元</th> <th>token 类型</th></tr></thead> <tbody><tr><td><code>const</code></td> <td><code>const</code></td></tr> <tr><td><code>a</code></td> <td><code>name</code></td></tr> <tr><td><code>=</code></td> <td><code>eq</code></td></tr> <tr><td><code>1</code></td> <td><code>num</code></td></tr> <tr><td><code>;</code></td> <td><code>semi</code></td></tr></tbody></table> <p>很显然这些类型对 Babel 来说是不够的，笔者整理了 Babel tokendizer 中的 token 类型。</p> <h4 id="空白"><a href="#空白" class="header-anchor">#</a> &quot;空白&quot;</h4> <p>&quot;空白&quot;包括: 格式控制符、空白符、行终止符:</p> <ul><li><p>格式控制符</p> <p>用于控制对源码文本的解释，但是并不会显示出来。</p></li> <li><p>空白符</p> <p>用于提升源码的可读性，并不影响源码的功能，通常用于将标记（tokens）分开。</p></li> <li><p>行终止符</p> <p>除了&quot;空白符&quot;之外，&quot;行终止符&quot;也可以提高源码的可读性。</p> <p>不同的是，&quot;行终止符&quot;可以影响 JavaScript 代码的执行。&quot;行终止符&quot;也会影响自动分号补全的执行。在正则表达式中，&quot;行终止符&quot;会被 <code>\s</code> 匹配。</p></li></ul> <p>下表是各种&quot;空白&quot;的介绍:</p> <table><thead><tr><th>分类</th> <th>编码</th> <th>名称</th> <th>缩写</th> <th>说明</th> <th>转义序列</th></tr></thead> <tbody><tr><td>格式控制符</td> <td><code>U+200C</code></td> <td>零宽不连字</td> <td><code>&lt;ZWNJ&gt;</code></td> <td>放置在一些经常会被当成连字的字符之间，用于将它们分别以独立形式显示</td> <td></td></tr> <tr><td>格式控制符</td> <td><code>U+200D</code></td> <td>零宽连字</td> <td><code>&lt;ZWJ&gt;</code></td> <td>放置在一些通常不会被标记为连字的字符之间，用于将这些字符以连字形式显示</td> <td></td></tr> <tr><td>格式控制符</td> <td><code>U+FEFF</code></td> <td>字节流方向标识</td> <td><code>&lt;BOM&gt;</code></td> <td>在脚本开头使用，除了将脚本标记为 <code>Unicode</code> 格式以外，还用来标记文本的字节流方向</td> <td></td></tr> <tr><td>空白符</td> <td><code>U+0009</code></td> <td>制表符</td> <td><code>&lt;HT&gt;</code></td> <td>水平制表符，就是TAB</td> <td><code>\t</code></td></tr> <tr><td>空白符</td> <td><code>U+000B</code></td> <td>垂直制表符</td> <td><code>&lt;VT&gt;</code></td> <td>垂直制表符，就是垂直方向的TAB</td> <td><code>\v</code></td></tr> <tr><td>空白符</td> <td><code>U+000C</code></td> <td>分页符</td> <td><code>&lt;FF&gt;</code></td> <td>分页符</td> <td><code>\f</code></td></tr> <tr><td>空白符</td> <td><code>U+0020</code></td> <td>空格</td> <td><code>&lt;SP&gt;</code></td> <td>空格</td> <td></td></tr> <tr><td>空白符</td> <td><code>U+00A0</code></td> <td>不换行空格</td> <td><code>&lt;NBSP&gt;</code></td> <td><code>&lt;SP&gt;</code> 的变体，非换行空格，<br>在文字排版中可以避免因为空格在此处发生断行，在 HTML 中使用的 <code>&amp;nbsp</code> 会生成它</td> <td></td></tr> <tr><td>空白符</td> <td><code>Others</code></td> <td>其他 Unicode 空白</td> <td><code>&lt;USP&gt;</code></td> <td></td> <td></td></tr> <tr><td>行终止符</td> <td><code>U+000A</code></td> <td>换行符</td> <td><code>&lt;LF&gt;</code></td> <td>在 UNIX 系统中起新行</td> <td><code>\n</code></td></tr> <tr><td>行终止符</td> <td><code>U+000D</code></td> <td>回车符</td> <td><code>&lt;CR&gt;</code></td> <td>在 Commodore 和早期的 Mac 系统中起新行</td> <td><code>\r</code></td></tr> <tr><td>行终止符</td> <td><code>U+2028</code></td> <td>行分隔符</td> <td><code>&lt;LS&gt;</code></td> <td>Unicode 中的行分隔符</td> <td></td></tr> <tr><td>行终止符</td> <td><code>U+2029</code></td> <td>段分隔符</td> <td><code>&lt;PS&gt;</code></td> <td>Unicode 中的段落分隔符</td> <td></td></tr></tbody></table> <p>Babel 中，有一个单独的文件提供了&quot;空白&quot;相关的工具方法: babel/packages/babel-parser/src/util/whitespace.js。</p> <p>其核心代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> lineBreak <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r\n?|[\n\u2028\u2029]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>

<span class="token comment">// https://tc39.github.io/ecma262/#sec-line-terminators</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isNewLine</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">code</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>lineFeed<span class="token operator">:</span> <span class="token comment">// &quot;\n&quot; &lt;LF&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>carriageReturn<span class="token operator">:</span> <span class="token comment">// &quot;\r&quot; &lt;CR&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>lineSeparator<span class="token operator">:</span> <span class="token comment">// 行分隔符 &lt;LS&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>paragraphSeparator<span class="token operator">:</span> <span class="token comment">// 段分隔符 &lt;PS&gt;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// https://tc39.github.io/ecma262/#sec-white-space</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isWhitespace</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">code</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">0x0009</span><span class="token operator">:</span> <span class="token comment">// CHARACTER TABULATION</span>
        <span class="token keyword">case</span> <span class="token number">0x000b</span><span class="token operator">:</span> <span class="token comment">// LINE TABULATION</span>
        <span class="token keyword">case</span> <span class="token number">0x000c</span><span class="token operator">:</span> <span class="token comment">// FORM FEED</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>space<span class="token operator">:</span> <span class="token comment">// 空格 &lt;SP&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>nonBreakingSpace<span class="token operator">:</span> <span class="token comment">// 不换行空格 &lt;NBSP&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>oghamSpaceMark<span class="token operator">:</span> <span class="token comment">// ?</span>
        <span class="token keyword">case</span> <span class="token number">0x2000</span><span class="token operator">:</span> <span class="token comment">// EN QUAD</span>
        <span class="token keyword">case</span> <span class="token number">0x2001</span><span class="token operator">:</span> <span class="token comment">// EM QUAD</span>
        <span class="token keyword">case</span> <span class="token number">0x2002</span><span class="token operator">:</span> <span class="token comment">// EN SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2003</span><span class="token operator">:</span> <span class="token comment">// EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2004</span><span class="token operator">:</span> <span class="token comment">// THREE-PER-EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2005</span><span class="token operator">:</span> <span class="token comment">// FOUR-PER-EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2006</span><span class="token operator">:</span> <span class="token comment">// SIX-PER-EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2007</span><span class="token operator">:</span> <span class="token comment">// FIGURE SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2008</span><span class="token operator">:</span> <span class="token comment">// PUNCTUATION SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2009</span><span class="token operator">:</span> <span class="token comment">// THIN SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x200a</span><span class="token operator">:</span> <span class="token comment">// HAIR SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x202f</span><span class="token operator">:</span> <span class="token comment">// NARROW NO-BREAK SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x205f</span><span class="token operator">:</span> <span class="token comment">// MEDIUM MATHEMATICAL SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x3000</span><span class="token operator">:</span> <span class="token comment">// IDEOGRAPHIC SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0xfeff</span><span class="token operator">:</span> <span class="token comment">// ZERO WIDTH NO-BREAK SPACE</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="注释"><a href="#注释" class="header-anchor">#</a> 注释</h4> <p>注释用来在源码中增加提示、笔记、建议、警告等信息，可以帮助阅读和理解源码。在调试时，可以用来将一段代码屏蔽掉，防止其运行。</p> <p>在 JavaScript 中，有 3 种添加注释的方法。</p> <ul><li><p>单行注释: <code>//</code> 后的文本都视为注释</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 这是单行注释</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>多行注释: <code>/* */</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
* 这是多行注释 1
* 这是多行注释 2
*/</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>Hashbang 注释: <code>#!</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>JavaScript 中的 hashbang 注释模仿 Unix 中的 <code>shebangs</code>，用于指定适当的解释器运行文件，它仅在脚本或模块的绝对开头有效。</p> <p>在计算领域中，Shebang（也称为 Hashbang）是一个由井号和叹号构成的字符序列 <code>#!</code>，其出现在文本文件的第一行的前两个字符。 在文件中存在 <code>Shebang</code> 的情况下，类 Unix 操作系统的程序加载器会分析 <code>Shebang</code> 后的内容，将这些内容作为解释器指令，并调用该指令，并将载有 <code>Shebang</code> 的文件路径作为该解释器的参数。</p> <p>例如，以指令 <code>#!/bin/sh</code> 开头的文件在执行时会实际调用 <code>/bin/sh</code> 程序。</p> <p>下面列出了一些典型的 shebang 解释器指令：</p> <ul><li><code>#!/bin/sh</code> — 使用 <code>sh</code>，即 Bourne shell<code>或其它兼容</code>shell` 执行脚本</li> <li><code>#!/bin/csh</code> — 使用 <code>csh</code>，即 C shell 执行</li> <li><code>#!/usr/bin/perl -w</code> — 使用带警告的 Perl 执行</li> <li><code>#!/usr/bin/python -O</code> — 使用具有代码优化的 Python 执行</li> <li><code>#!/usr/bin/php</code> — 使用 PHP 的命令行解释器执行</li></ul></li></ul> <p>文件 babel/packages/babel-parser/src/tokenizer/index.js 中有与注释相关的处理方法，tokenizer 对注释的处理方式分为两种:</p> <ul><li><p>单行和多行注释，视为&quot;空白&quot;</p> <p><code>skipSpace()</code> 方法会识别注释并添加到 <code>commentStack</code> 数组中。</p> <p>识别时，以 <code>/</code> 为关注点，检测下一个字符是 <code>*</code> 或 <code>/</code>。</p> <p>如果下一个字符是 <code>*</code>，进入 <code>skipBlockComment()</code> 的执行流程；</p> <p>如果下一个字符是 <code>/</code>，进入<code>skipLineComment()</code> 的执行流程。</p></li> <li><p>Hashbang 注释的处理方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_interpreter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
    <span class="token comment">// 如果字符起始位置不是第一个字符，就直接返回，不做处理</span>
    <span class="token comment">// 如果长度不够 2，也不做处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!==</span> charCodes<span class="token punctuation">.</span>exclamationMark<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// !</span>

    <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNewLine</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 取出 #! xxx 中的 xxx 作为 value 值</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>interpreterDirective<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>该方法会识别并取出 <code>#! xxx</code> 中的 <code>xxx</code> 作为该 token 的值。</p></li></ul> <h4 id="标识符-name"><a href="#标识符-name" class="header-anchor">#</a> 标识符: <code>name</code></h4> <p>标识符是代码中用来标识变量、函数、或属性的字符序列。</p> <p>在 JavaScript 中，标识符只能包含字母或数字或下划线（<code>&quot;_&quot;</code>）或美元符号（<code>&quot;$&quot;</code>），且不能以数字开头。</p> <p>文件 babel/packages/babel-parser/src/tokenizer/index.js 中与标识符识别相关的方法是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readWord</span><span class="token punctuation">(</span>firstCode<span class="token operator">:</span> number <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> word <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readWord1</span><span class="token punctuation">(</span>firstCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> type <span class="token operator">=</span> keywordTypes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> <span class="token operator">||</span> tt<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">readWord1</span><span class="token punctuation">(</span>firstCode<span class="token operator">:</span> numbder <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="数字直接量-num"><a href="#数字直接量-num" class="header-anchor">#</a> 数字直接量: <code>num</code></h4> <ul><li><p>JavaScript 中表示数字的方式</p> <ul><li><p>字面量</p> <p>使用字面量（literal）直接表示一个数值时，JavaScript 对整数提供四种进制的表示方法: 十进制、十六进制、八进制、二进制。</p> <ul><li><p>十进制: 没有前导 <code>0</code> 的数值。</p> <p>只有十进制可以带小数和用科学计数法表示。</p> <p>带小数时小数点前后部分都可以省略（不能同时省略），如 <code>0.1 / 1. / 2.4</code>。</p></li> <li><p>八进制: 有前缀 <code>0o</code> 或 <code>0O</code> 的数值，或者有前导 <code>0</code>、且只用到 <code>0-7</code> 的八个阿拉伯数字的数值。</p></li> <li><p>十六进制: 有前缀 <code>0x</code> 或 <code>0X</code> 的数值。</p></li> <li><p>二进制: 有前缀 <code>0b</code> 或 <code>0B</code> 的数值。</p></li></ul></li> <li><p>科学计数法</p> <p>科学计数法表示允许字母 <code>e</code> 或 <code>E</code> 的后面，跟着一个整数，表示这个数值的指数部分。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">123e3</span> <span class="token comment">// 123000</span>
<span class="token number">123e-3</span> <span class="token comment">// 0.123</span>
<span class="token operator">-</span><span class="token number">3.1E+12</span>
<span class="token number">.1e-23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>特殊数值</p> <ul><li><p>正零和负零</p> <p>在 JavaScript 的 64 位浮点数中，有一个二进制位是符号位，那么，0 也是有一个对应的负值的。<code>+0</code> 和 <code>-0</code> 都指的是 <code>0</code>，只是它们的64位浮点数表示法的符号位不同。</p> <p>一般状态下，<code>+0</code> 和 <code>-0</code> 是等价的，会被当做正常的<code>0</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">+</span><span class="token number">0</span> <span class="token comment">// 0</span>
<span class="token operator">-</span><span class="token number">0</span> <span class="token comment">// 0</span>
<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// '0'</span>
<span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// '0'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>只是，如果 <code>+0</code> 和 <code>-0</code> 作为分母，则有一些区别:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为 <code>1 / +0</code> 的结果是 <code>+Infinity</code>，<code>1 / -0</code> 的结果是 <code>-Infinity</code>。</p></li> <li><p><code>NaN</code></p></li> <li><p><code>Infinity</code></p></li></ul></li></ul></li> <li><p>文件 babel/packages/babel-parser/src/tokenizer/index.js 对数字的处理</p> <ul><li><p><code>readInt()</code></p> <p>TODO</p></li> <li><p><code>readRadixNumber()</code></p> <p>TODO</p></li> <li><p><code>readNumber()</code></p> <p>TODO</p></li></ul></li></ul> <h4 id="正则表达式直接量-regexp"><a href="#正则表达式直接量-regexp" class="header-anchor">#</a> 正则表达式直接量: <code>regexp</code></h4> <ul><li><p>正则的 <code>flag</code></p> <p>正则有如下 <code>flag</code>: <code>g/m/s/i/y/u/d</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>charCodes<span class="token punctuation">.</span>lowercaseG
charCodes<span class="token punctuation">.</span>lowercaseM
charCodes<span class="token punctuation">.</span>lowercaseS
charCodes<span class="token punctuation">.</span>lowercaseI
charCodes<span class="token punctuation">.</span>lowercaseY
charCodes<span class="token punctuation">.</span>lowercaseU
charCodes<span class="token punctuation">.</span>lowercaseD
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>tokenizer 对正则的处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readRegexp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> escaped<span class="token punctuation">,</span> inClass<span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> pos <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedRegExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNewLine</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遇到换行符，抛出错误，遇到未完结的正则表达式</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedRegExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>escaped<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            escaped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>leftSquareBracket<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// [</span>
                inClass <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>rightSquareBracket <span class="token operator">&amp;&amp;</span> inClass<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ]</span>
                inClass <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>slash <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>inClass<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// /</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            escaped <span class="token operator">=</span> ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>backslash<span class="token punctuation">;</span> <span class="token comment">// \</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 内容</span>
    <span class="token operator">++</span>pos<span class="token punctuation">;</span>

    <span class="token keyword">let</span> mods <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">codePointAtPos</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// It doesn't matter if cp &gt; 0xffff, the loop will either throw or break because we check on cp</span>
        <span class="token keyword">const</span> char <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">VALID_REGEX_FLAGS</span><span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mods<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>DuplicateRegExpFlags<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重复的 flag</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isIdentifierChar</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span> <span class="token operator">||</span> cp <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>backslash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>MalformedRegExpFlags<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 非法正则</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token operator">++</span>pos<span class="token punctuation">;</span>
        mods <span class="token operator">+=</span> char<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">=</span> pos<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>regexp<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">pattern</span><span class="token operator">:</span> content<span class="token punctuation">,</span>
        <span class="token literal-property property">flags</span><span class="token operator">:</span> mods<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></li></ul> <h4 id="字符串直接量-string"><a href="#字符串直接量-string" class="header-anchor">#</a> 字符串直接量: <code>string</code></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readString</span><span class="token punctuation">(</span>quote<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> out <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        chunkStart <span class="token operator">=</span> <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> quote<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>backslash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            out <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>chunkStart<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// $FlowFixMe</span>
            out <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readEscapedChar</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            chunkStart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
            ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>lineSeparator <span class="token operator">||</span>
            ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>paragraphSeparator
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>curLine<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lineStart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNewLine</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    out <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>chunkStart<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>string<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="模板字符串-template"><a href="#模板字符串-template" class="header-anchor">#</a> 模板字符串: <code>template</code></h4> <p>模板字符串是允许嵌入表达式的字符串字面量，可以使用多行、表达式引入、标签引入功能。</p> <p>它有如下形态:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 单行</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 多行</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text line 1
string text line 2</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 表达式引入</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> string text</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 标签引入</span>
tag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> string text</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>token 解析时，需要对以下情况做处理。</p> <ul><li>该代码段第一批字符是 ` 开头的话，会记录为一个 <code>tt.backQuote</code> 类型</li> <li>该代码段第一批字符是 <code>${</code> 开头的话，会记录为一个 <code>tt.dollarBraceL</code> 类型</li> <li>在扫描该代码段途中，遇到转译标志 <code>\</code>、换行 <code>\r</code> 及 <code>\n</code> 时，会继续扫描检查是否满足对目标格式的要求</li></ul> <h4 id="符号"><a href="#符号" class="header-anchor">#</a> 符号</h4> <p>JavaScript 中有如下符号:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token operator">...</span> <span class="token punctuation">;</span> <span class="token punctuation">,</span> <span class="token operator">&lt;</span> <span class="token operator">&gt;</span> <span class="token operator">&lt;=</span> <span class="token operator">&gt;=</span> <span class="token operator">==</span> <span class="token operator">!=</span> <span class="token operator">===</span> <span class="token operator">!==</span> <span class="token operator">+</span> <span class="token operator">-</span> <span class="token operator">*</span> <span class="token operator">%</span> <span class="token operator">**</span> <span class="token operator">++</span> <span class="token operator">--</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token operator">&amp;</span> <span class="token operator">|</span> <span class="token operator">^</span> <span class="token operator">!</span> <span class="token operator">~</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">||</span> <span class="token operator">?</span> <span class="token operator">:</span> <span class="token operator">=</span> <span class="token operator">+=</span> <span class="token operator">-=</span> <span class="token operator">*=</span> <span class="token operator">%=</span> <span class="token operator">**=</span> <span class="token operator">&lt;&lt;=</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">&gt;&gt;&gt;=</span> <span class="token operator">&amp;=</span> <span class="token operator">|=</span> <span class="token operator">^=</span> <span class="token operator">=&gt;</span> <span class="token operator">/</span> <span class="token operator">/=</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>因需识别字符串模板，<code>{</code> 和 <code>}</code> 也被视为可能有意义的符号
因需识别除法和正则，<code>/</code> 也被视为可能有意义的符号</p></blockquote> <ul><li><p><code>.</code>: <code>dot</code></p> <p>当源码遍历过程中，遇到 <code>.</code> 字符时，会调用 <code>readToken_dot</code> 方法。</p> <p><code>.</code>开头的合法 token 的值有两种: 数字（如 <code>.123</code>）、扩展运算符（<code>...</code>）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_dot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 识别 &quot;.123&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">&gt;=</span> charCodes<span class="token punctuation">.</span>digit0 <span class="token operator">&amp;&amp;</span> next <span class="token operator">&lt;=</span> charCodes<span class="token punctuation">.</span>digit9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readNumber</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 识别 &quot;...&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>dot <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>dot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>ellipsis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>dot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p><code>/</code>: <code>slash</code></p> <p>当源码遍历过程中，遇到 <code>/</code> 字符时，会调用 <code>readToken_slash</code>方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_slash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// /=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>slashAssign<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>slash<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>该方法可以识别2种token: <code>/=</code>、<code>/</code>。</p></li> <li><p><code>*</code>: <code>star</code> 或 <code>%</code>: <code>modulo</code></p> <p>当源码遍历过程中，遇到 <code>*</code> 或 <code>%</code> 字符时，会调用 <code>readToken_mult_modulo</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_mult_modulo</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// '%*'</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>asterisk <span class="token operator">?</span> tt<span class="token punctuation">.</span>star <span class="token operator">:</span> tt<span class="token punctuation">.</span>modulo<span class="token punctuation">;</span> <span class="token comment">// asterisk: *</span>
    <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Exponentiation operator **</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>asterisk <span class="token operator">&amp;&amp;</span> next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>asterisk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        width<span class="token operator">++</span><span class="token punctuation">;</span>
        next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        type <span class="token operator">=</span> tt<span class="token punctuation">.</span>exponent<span class="token punctuation">;</span> <span class="token comment">// **</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        width<span class="token operator">++</span><span class="token punctuation">;</span>
        type <span class="token operator">=</span> tt<span class="token punctuation">.</span>assign<span class="token punctuation">;</span> <span class="token comment">// *= / %=</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>该方法可以识别 3 种 token: <code>**</code>、<code>*=</code>、<code>%=</code>。</p></li> <li><p><code>|</code> 或 <code>&amp;</code></p> <p>当源码遍历过程中，遇到 <code>|</code> 或 <code>&amp;</code> 字符时，会调用 <code>readToken_pipe_amp</code> 方法。</p> <p>该方法可以识别 3 种 token: <code>||</code>、 <code>、&amp;&amp;</code>、 <code>、||=</code>、 <code>、&amp;&amp;=</code>、<code>|&gt;</code>、<code>|}</code>、<code>|]</code>。</p> <p>值得注意的是，该方法内部有对部分插件的引入要求:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// '|}'</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span><span class="token string">&quot;recordAndTuple&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>rightCurlyBrace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 要求引入插件 babel-plugin-syntax-record-and-tuple，</span>
    <span class="token comment">// 并且插件的 syntaxType 配置项的值不能是 &quot;bar&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPluginOption</span><span class="token punctuation">(</span><span class="token string">&quot;recordAndTuple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;syntaxType&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有引入插件，抛出</span>
        <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">,</span>
            Errors<span class="token punctuation">.</span>RecordExpressionBarIncorrectEndSyntaxType<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p><code>^</code></p> <p>当源码遍历过程中，遇到 <code>^</code> 字符时，会调用 <code>readToken_caret</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_caret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ^=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>bitwiseXOR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异或运算符</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>该方法可以识别 2 种 token: <code>^=</code>、<code>^</code>。</p></li> <li><p><code>+</code> 或 <code>-</code></p> <p>当源码遍历过程中，遇到 <code>+</code> 或 <code>-</code> 字符时，会调用 <code>readToken_plus_min</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_plus_min</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// '+-'</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>incDec<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ++ --</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// += -=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>plusMin<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// + -</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>该方法可以识别6种token: <code>++</code>、<code>--</code>、<code>+=</code>、<code>-=</code>、<code>+</code>、<code>-</code>。</p></li> <li><p><code>&lt;</code> 或 <code>&gt;</code></p> <p>当源码遍历过程中，遇到 <code>&lt;</code> 或 <code>&gt;</code> 字符时，会调用 <code>readToken_lt_gt</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_lt_gt</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// '&lt;&gt;'</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        size <span class="token operator">=</span>
            code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>greaterThan <span class="token operator">&amp;&amp;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>greaterThan
            <span class="token operator">?</span> <span class="token number">3</span>
            <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> size<span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>bitShift<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;&lt; &gt;&gt;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &lt;= | &gt;=</span>
        size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>relational<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>readToken_lt_gt</code> 方法可以识别 6 种 token: <code>&lt;&lt;</code>、<code>&gt;&gt;</code>、<code>&lt;</code>、<code>&gt;</code>、<code>&lt;=</code>、<code>&gt;=</code>。</p></li> <li><p><code>=</code> 或 <code>!</code></p> <p>当源码遍历过程中，遇到 <code>=</code> 或 <code>!</code> 时，会调用 <code>readToken_eq_excl</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_eq_excl</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span> <span class="token comment">// = !</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// == !=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>
            tt<span class="token punctuation">.</span>equality<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo
            <span class="token operator">?</span> <span class="token number">3</span>
            <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// === !== == !=</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo <span class="token operator">&amp;&amp;</span> next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>greaterThan<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// '=&gt;'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>arrow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo <span class="token operator">?</span> tt<span class="token punctuation">.</span>eq <span class="token operator">:</span> tt<span class="token punctuation">.</span>bang<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>readToken_lt_gt</code>方法可以识别7种token: <code>=</code>、<code>!</code>、 <code>==</code>、<code>!=</code>、<code>===</code>、<code>!==</code>、<code>==&gt;</code>。</p></li> <li><p><code>?</code></p> <p>当源码遍历过程中，遇到 <code>?</code> ，会调用 <code>readToken_eq_excl</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_question</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> next2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>questionMark<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ??</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next2 <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ??=</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>nullishCoalescing<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ??</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>dot <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span><span class="token punctuation">(</span>next2 <span class="token operator">&gt;=</span> charCodes<span class="token punctuation">.</span>digit0 <span class="token operator">&amp;&amp;</span> next2 <span class="token operator">&lt;=</span> charCodes<span class="token punctuation">.</span>digit9<span class="token punctuation">)</span> <span class="token comment">// ?.</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// '.' not followed by a number</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>questionDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>question<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ?</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>readToken_lt_gt</code> 方法可以识别 4 种 token: <code>?</code>、<code>??</code>、<code>??=</code>、<code>?.</code>。</p></li></ul> <h3 id="词法错误"><a href="#词法错误" class="header-anchor">#</a> 词法错误</h3> <ul><li><p>词法错误发生的时机</p> <p><code>Tokenizer</code> 使用继承自 <code>babel/packages/babel-parser/src/parser/error.js</code> 的 <code>raise()</code> 方法抛出词法分析中扫描到的错误。</p> <p><code>Tokenizer</code> 中抛出词法错误的时机有如下几种场景:</p> <ul><li><p>严格模式中发现错误</p> <p>严格模式（<code>&quot;use strict;&quot;</code>）下有一系列的限制条件，<code>Tokenizer</code> 在分析过程中，会尝试发现这些错误并抛出。</p> <ul><li>禁止出现 <code>0</code> 开头的数字，如 <code>&quot;use strict&quot;; 010;</code>，在词法分析阶段就会发现并抛出该错误，但允许 <code>\\0</code> 开头的数字</li> <li>禁止出现八进制数字</li></ul></li> <li><p>扫描到的疑似词法单元不满足格式要求</p> <p>比如块级注释 <code>/* */</code> 缺乏闭合标签、hashbang 注释 <code>#!</code> 匹配到了不合适的字符如 <code>#2</code>、正则表达式缺乏闭合标签等。</p></li> <li><p>缺乏必要的 Babel 插件引入</p> <p>对于某些特殊词法单元，需要显示引入对应的插件才会开启支持，否则会抛出错误。</p> <p><code>Tokenizer</code> 在解析时，出现过多次对 <code>recordAndTuple</code> 插件的引入要求。</p> <ul><li><code>#{</code> 语法要求引入 <code>recordAndTuple</code> 插件且 <code>syntaxType</code> 配置项设置为 <code>hash</code></li> <li><code>{|</code> 和 <code>|}</code> 语法要求引入 <code>recordAndTuple</code> 插件且 <code>syntaxType</code> 配置项设置为 <code>bar</code></li></ul></li> <li><p>未知的词法单元，也就是常见的 <code>UnexpectedToken</code></p> <p>如果 Babel 定义的词法单元都没有被识别出的话，就会抛出 <code>UnexpectedToken</code> 类型的错误，文案描述为 <code>&quot;Unexpected character ...&quot;</code>。</p> <p>比如，源码中出现了一个不属于任何词法单元类型的字符时，会抛出 <code>UnexpectedToken</code> 的错误:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> · <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在词法解析时就会抛出错误: <code>Unexpected character '·'.</code>，因为 <code>·</code> 并不是一个合法的词法单元字符。</p></li></ul></li> <li><p>词法错误列表</p> <p>在词法分析时，是能够发现源码中的一些问题的，比如括号缺少闭合标签等。</p> <p>这里列举了 Babel 在词法分析阶段能够发现的错误:</p> <blockquote><p>错误描述定义在文件 <code>babel/packages/babel-parser/src/parser/error-message.js</code></p></blockquote> <ul><li><p><code>RecordExpressionBarIncorrectStartSyntaxType</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Record expressions starting with <span class="token string">'{|'</span> are only allowed when the <span class="token string">'syntaxType'</span> option of the <span class="token string">'recordAndTuple'</span> plugin is <span class="token builtin class-name">set</span> to <span class="token string">'bar'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>{|</code> 语法要求引入 <code>recordAndTuple</code> 插件且 <code>syntaxType</code> 配置项设置为 <code>bar</code>。</p></li> <li><p><code>InvalidOrUnexpectedToken</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected character <span class="token string">'%0'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>出现了非法的 token 字符。</p></li> <li><p><code>UnterminatedRegExp</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unterminated regular expression.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>未闭合的正则表达式。</p></li> <li><p><code>DuplicateRegExpFlags</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Duplicate regular expression flag.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重复的正则 flag。</p></li> <li><p><code>MalformedRegExpFlags</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid regular expression flag.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>非法的正则 flag</p></li> <li><p><code>UnexpectedNumericSeparator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>A numeric separator is only allowed between two digits.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>1_a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: A numeric separator is only allowed between two digits. <span class="token punctuation">(</span><span class="token number">1</span>:1<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> 1_a
    <span class="token operator">|</span>  ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>NumericSeparatorInEscapeSequence</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Numeric separators are not allowed inside unicode escape sequences or hex escape sequences.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidDigit</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Expected number <span class="token keyword">in</span> radix %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidDecimal</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid decimal.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>NumberIdentifier</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Identifier directly after number.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>无效的小数。</p></li> <li><p><code>InvalidNumber</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid number.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>非法数字。</p></li> <li><p><code>ZeroDigitNumericSeparator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Numeric separator can not be used after leading <span class="token number">0</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidOrMissingExponent</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Floating-point numbers require a valid exponent after the <span class="token string">'e'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidBigIntLiteral</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid BigIntLiteral.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>非法的大数字面量。</p></li> <li><p><code>InvalidCodePoint</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Code point out of bounds.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>UnterminatedString</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unterminated string constant.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>未闭合的字符串。</p></li> <li><p><code>InvalidEscapeSequence</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Bad character escape sequence.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>MissingUnicodeEscape</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Expecting Unicode escape sequence <span class="token punctuation">\</span><span class="token punctuation">\</span>uXXXX.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>EscapedCharNotAnIdentifier</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid Unicode escape.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidEscapedReservedWord</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Escape sequence <span class="token keyword">in</span> keyword %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul> <h1 id="语法分析和语义分析"><a href="#语法分析和语义分析" class="header-anchor">#</a> 语法分析和语义分析</h1> <p>语法分析（syntactic analysis）的作用是在词法分析的基础上，遍历 token，从而识别出程序的抽象语法树（AST），它是一个树形结构。这个树形结构主要描述了源码的结构，暂时还缺少语义信息，比如作用域、类型检查等，我们将在语义分析的环节详细介绍。</p> <p>以英文句子 <code>&quot;today is comfortable.&quot;</code> 为例，对其词法分析就是将句子分离为各个单词，而语法分析关注的是单词和单词之间的关系，这些关系就是所谓的语法。</p> <p>https://www.tr0y.wang/2021/04/04/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E8%AF%AD%E4%B9%89%E5%88%86%E6%9E%90/</p> <p>语义分析负责分析上下文相关的情况，和具体语言相关。</p> <h2 id="相关概念-2"><a href="#相关概念-2" class="header-anchor">#</a> 相关概念</h2> <h3 id="抽象语法树和具象语法树"><a href="#抽象语法树和具象语法树" class="header-anchor">#</a> 抽象语法树和具象语法树</h3> <ul><li><p>具象语法树（concrete syntax tree, CST）</p> <p>具象语法树（concrete syntax tree, CST），又称为语法树（syntax tree），它是源码的树状表示，会展示各种语法细节。</p> <p>TODO（画图）</p></li> <li><p>抽象语法树（abstract syntax tree, AST）</p> <p>抽象语法树也是树形结构，只不过相对于具象语法树，其不会展示源码的各种语法细节。</p> <p>TODO（画图）</p></li> <li><p>不同点</p> <ul><li><p>AST 使用操作符作为根节点和内部节点，并用操作数作为子节点</p> <p>TODO（画图）</p></li> <li><p>与 CST 不同，AST 不适用内部节点表示语法规则</p> <p>TODO（画图）</p></li> <li><p>AST 不代表真实语法的每个细节，比如，它省略了括号等细节</p> <p>TODO（画图）</p></li> <li><p>与 CST 相比，AST 更密集</p> <p>TODO（画图）</p></li></ul></li> <li><p>案例</p> <p>TODO（画图）</p></li></ul> <h3 id="语法分析器"><a href="#语法分析器" class="header-anchor">#</a> 语法分析器</h3> <p>语法分析器负责接收 token 列表，生成源码的抽象语法树，此时的抽象语法树，重点在描述源码的程序结构信息。</p> <h3 id="上下文无关文法"><a href="#上下文无关文法" class="header-anchor">#</a> 上下文无关文法</h3> <ul><li><p>文法</p> <p>以英文句子 <code>&quot;today is comfortable.&quot;</code> 为例，文法用于定义该句子的结构，对于编程语言，文法用户定义编程语言的结构。</p></li> <li><p>乔姆斯基文法体系</p> <p>一位叫乔姆斯基的教授准备利用数学来研究人类自然语言的规律，在此期间，他总结了很多数学工具和方法，称为&quot;乔姆斯基文法体系&quot;。但这套体系在计算机领域进行了发扬光大，用于对程序语言进行结构分析。</p> <p>乔姆斯基文法体系有4类文法:</p> <ul><li>0 型文法: 任意文法，在程序设计语言中不常用</li> <li>1 型文法: 上下文相关文法，在程序设计语言中不常用</li> <li>2 型文法: 上下文无关文法（Context-free Grammar，CFG）在程序设计中用于描述程序语言的语法结构</li> <li>3 型文法: 正则文法，就是词法分析中的正则表达式，可以用来描述程序语言的词法结构</li></ul> <p>所有文法中，0 型文法的表达能力最强，3 型文法最弱，如图:</p> <p>TODO（画图）</p></li> <li><p>上下文无关文法（Context-free Grammar，CFG）</p> <p>下文无关文法，指的是该文法定义的所有句子结构之间是没有任何关系的，比如 <code>ID = ID + ID</code>，我们不需要关注 <code>ID</code> 是怎么来的，上下文有什么和它有关的内容，我们只需要关心一个字符是否是 <code>ID</code>，并且 <code>ID</code> 的等价形式是什么。</p> <p>https://www.cnblogs.com/jacksplwxy/p/10052752.html</p> <p>一个上下文无关文法包括四个部分: 终结符号集合，非终结符号集合，起始符号，产生式集合。</p></li> <li><p>用上下文无关文法描述算术表达式</p> <p>TODO</p></li></ul> <h3 id="生成-ast-的算法"><a href="#生成-ast-的算法" class="header-anchor">#</a> 生成 AST 的算法</h3> <p>有两种方式可以生成 AST: 自顶向下分析、自底向上分析。</p> <ul><li><p>自顶向下分析</p> <p>在自顶向下分析中，&quot;递归下降&quot;算法是常用的一种算法，&quot;递归下降&quot;算法包括两个要点: &quot;下降&quot;和&quot;递归&quot;。</p> <ul><li><p>下降</p></li> <li><p>递归</p></li> <li><p>左递归</p></li></ul></li> <li><p>自底向上分析</p> <p>TODO</p> <ul><li>自顶向下分析: 根据形式语法规则，在语法分析树的自顶向下展开中搜索输入符号串可能的最左推导。单词按从左到右的顺序依次使用。</li> <li>自底向上分析: 语法分析器从现有的输入符号串开始，尝试将其根据给定的形式语法规则进行改写，最终改写为语法的起始符号。</li></ul></li></ul> <h3 id="引用消解"><a href="#引用消解" class="header-anchor">#</a> 引用消解</h3> <p>引用消解解决的是如何找到引用的定义的问题。比如下述案例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1</span><span class="token operator">&gt;</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">2</span><span class="token operator">&gt;</span>
<span class="token number">3</span><span class="token operator">&gt;</span> <span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">4</span><span class="token operator">&gt;</span>     <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token number">5</span><span class="token operator">&gt;</span>     <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token number">6</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token number">7</span><span class="token operator">&gt;</span> 
<span class="token number">8</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在外层环境和 <code>run()</code> 内部都定义了变量 <code>a</code>，无论是编辑器快速跳到 <code>a</code> 变量的定义，还是在运行时，都能准确发现第五行的变量 <code>a</code> 的值是第四行的 <code>2</code>。这个发现定义的过程就是引用消解。</p> <h3 id="左值和右值"><a href="#左值和右值" class="header-anchor">#</a> 左值和右值</h3> <p>左值和右值是开发编译器、解释器时绕不开的一个话题，什么是左值和右值呢？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>a <span class="token operator">+</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面这个例子中，很显然取的是变量 <code>a</code> 的值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>a <span class="token operator">=</span> <span class="token number">5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个例子中，取的是变量 <code>a</code> 的地址，并将 <code>5</code> 赋值到该地址对应的值中，当然这部分是 JavaScript 内部的处理。</p> <p>对于 Babel 这样的转译器而言，需要区分源码中，哪些属于赋值操作，哪些属于取值操作。</p> <p>简单而言，左值指的就是赋值的目标，右值指的就是取值的目标。</p> <p>满足左值，自然要满足一些条件:</p> <ul><li>节点位于赋值表达式的左边</li> <li>节点位于函数的形参</li> <li>一元操作符: <code>++</code> 或 <code>--</code></li> <li>其他需要改变变量值的情况</li></ul> <p>对于像 <code>a + 3</code>、<code>a = 5</code> 这样的代码，对应到语法树上，都叫做 <code>xxxx</code> 节点，那么用什么方式区分它们是左值还是右值呢，就需要在 <code>xxxx</code> 节点上添加一些属性进行标记。</p> <p>获取这些标记属性的过程，叫&quot;属性计算&quot;。</p> <h3 id="属性计算"><a href="#属性计算" class="header-anchor">#</a> 属性计算</h3> <ul><li><p>属性文法</p> <p>在词法分析中涉及到了正则文法，在语法分析中涉及到了上下文无关文法。而在语义分析中，涉及到了属性文法。</p> <p>属性文法计算的是语义分析中，某个节点的上下文信息，比如某个节点的值（<code>value</code>）就是一种典型的属性计算。</p> <p>用语法分析中涉及的上下文无关文法来描述加法计算，描述如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>add → add <span class="token operator">+</span> mul
add → mul
mul → mul <span class="token operator">*</span> primary
mul → primary
primary → <span class="token string">&quot;(&quot;</span> add <span class="token string">&quot;)&quot;</span>
primary → integer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在上述上下文无关文法的描述基础上，针对节点的 <code>value</code> 属性，用属性文法描述如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>dd1 → add1 <span class="token operator">+</span> mul <span class="token punctuation">[</span> add1<span class="token punctuation">.</span>value <span class="token operator">=</span> add2<span class="token punctuation">.</span>value <span class="token operator">+</span> mul<span class="token punctuation">.</span>value <span class="token punctuation">]</span>
add → mul <span class="token punctuation">[</span> add<span class="token punctuation">.</span>value <span class="token operator">=</span> mul<span class="token punctuation">.</span>value <span class="token punctuation">]</span>
mul1 → mul2 <span class="token operator">*</span> primary <span class="token punctuation">[</span> mul1<span class="token punctuation">.</span>value <span class="token operator">=</span> mul2<span class="token punctuation">.</span>value <span class="token operator">*</span> primary<span class="token punctuation">.</span>value <span class="token punctuation">]</span>
mul → primary <span class="token punctuation">[</span> mul<span class="token punctuation">.</span>value <span class="token operator">=</span> primary<span class="token punctuation">.</span>value <span class="token punctuation">]</span>
primary → <span class="token string">&quot;(&quot;</span> add <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span> primary<span class="token punctuation">.</span>value <span class="token operator">=</span> add<span class="token punctuation">.</span>value <span class="token punctuation">]</span>
primary → integer <span class="token punctuation">[</span> primary<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">strToInt</span><span class="token punctuation">(</span>integer<span class="token punctuation">.</span>str<span class="token punctuation">)</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这就是属性文法定义的针对 <code>value</code> 的规则，规则确定后，就能通过工具计算出该属性的值。</p> <p>这种属性文法定义的规则，叫做语法制导的定义（Syntax directed definition，SDD），如果变成计算动作，就叫做语法制导的翻译（Syntax directed translation，SDT）。</p></li> <li><p>综合属性和继承属性</p> <ul><li><p>综合属性（S 属性，Synthesized Attribute）</p> <p>如果一种属性能够由下级节点推导出来，那么这种属性就叫 S 属性（Synthesized Attribute），也就是综合属性，能够从下级节点的属性归纳、计算为本节点的属性。</p> <p>比如:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>a <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">+</span> <span class="token number">2</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在语义分析阶段，Babel 等转译器已经可以知道变量 <code>a</code> 的类型是 <code>string</code> 了，而这个类型是由&quot;类型推导&quot;而来，变量 <code>a</code> 的类型由其两个子节点（字符串 <code>'1'</code> 和数字 <code>2</code> ）决定，这两个子节点的类型推导出了 <code>a</code> 的类型。</p></li> <li><p>继承属性（I属性，Inherited Attribute）</p> <p>与S属性相对应，I属性（Inherited Attribute）意为继承属性，它可以通过当前节点的上级节点、兄弟节点、自身节点来决定。</p> <p>TODO</p></li></ul></li> <li><p>属性计算的时机</p> <p>属性计算逻辑上位于语义分析环节，但是在实际编译逻辑执行中，进行语法分析生成AST的同时，属性计算等语义分析也可以同步进行。</p> <p>比如，在语法分析的时候，如果某个节点的属性可以通过其他节点（父节点、兄弟节点）计算而来，那么该属性可以在构建 AST 的时候顺便执行了计算。</p> <p>另外，语法分析生成 AST 后，语义分析可以根据需要，对 AST 进行多次遍历，为其进行不同的属性计算。</p></li> <li><p>属性计算在语义分析中的应用</p> <ul><li>作用域解析</li> <li>引用消解</li> <li>类型推导</li> <li>类型检查</li> <li>类型转换</li> <li>语义合法性检查</li></ul></li></ul> <h2 id="语法分析和语义分析过程"><a href="#语法分析和语义分析过程" class="header-anchor">#</a> 语法分析和语义分析过程</h2> <h3 id="第1步-确定文法规则"><a href="#第1步-确定文法规则" class="header-anchor">#</a> 第1步: 确定文法规则</h3> <p>TODO</p> <h3 id="第2步-自顶向下分析"><a href="#第2步-自顶向下分析" class="header-anchor">#</a> 第2步: 自顶向下分析</h3> <p>TODO</p> <h2 id="babel-的语法分析和语义分析"><a href="#babel-的语法分析和语义分析" class="header-anchor">#</a> Babel 的语法分析和语义分析</h2> <p>语法分析的目的是生成源码的结构化表示，即抽象语法树（AST），此时并不需要特别关注语义方面的问题，专注生成 AST。</p> <h3 id="源码结构"><a href="#源码结构" class="header-anchor">#</a> 源码结构</h3> <p>文件 <code>babel/packages/babel-parser/src/parser/index.js</code> 既包含了词法分析模块，也包含了语法和语义分析模块。其定义了 <code>Parser</code> 类，在内部实现上有一系列的继承关系:</p> <table><thead><tr><th>继承顺序</th> <th>作用</th></tr></thead> <tbody><tr><td><code>Parser</code></td> <td>对外提供语法分析能力</td></tr> <tr><td><code>StatementParser</code></td> <td>解析声明</td></tr> <tr><td><code>ExpressionParser</code></td> <td>解析表达式</td></tr> <tr><td><code>LValParser</code></td> <td>解析左值</td></tr> <tr><td><code>NodeUtils</code></td> <td>AST节点的各种属性和方法</td></tr> <tr><td><code>UtilParser</code></td> <td></td></tr> <tr><td><code>Tokenizer</code></td> <td>词法分析器</td></tr> <tr><td><code>ParserErrors</code></td> <td>错误处理模块</td></tr> <tr><td><code>CommentsParser</code></td> <td>对注释进行解析</td></tr> <tr><td><code>BaseParser</code></td> <td>提供基础属性和关于插件的工具方法</td></tr></tbody></table> <p>通过观察 Babel Parser 中的继承链，我们也可以了解完整的语法分析可以分解为哪些模块。</p> <p>这里先介绍一些基础模块的功能，如 <code>BaseParser/ErrorParser</code>，其他模块将在介绍 Babel 的语法分析、语义分析时分别详细介绍。</p> <h4 id="baseparser"><a href="#baseparser" class="header-anchor">#</a> <code>BaseParser</code></h4> <p><code>BaseParser</code> 类作为继承链的基础类，提供了一些基础属性和方法，为继承链的其他类使用。</p> <p>由此可以看出，&quot;继承链&quot;也是一种良好的代码复用的方式。</p> <p><code>BaseParser</code> 定义了一些属性和方法。</p> <ul><li><p>属性</p> <ul><li><p><code>options</code></p> <p><code>babel-parser</code> 对外暴露方法的配置项，参数类型定义在 <code>babel/packages/babel-parser/src/options.js</code>。</p> <ul><li><p><code>sourceType</code>: <code>SourceType</code></p></li> <li><p><code>sourceFilename</code>: <code>string</code></p></li> <li><p><code>startLine</code>: <code>number</code></p></li> <li><p><code>allowAwaitOutsideFunction</code>: <code>boolean</code></p></li> <li><p><code>allowReturnOutsideFunction</code>: <code>boolean</code></p></li> <li><p><code>allowImportExportEverywhere</code>: <code>boolean</code></p></li> <li><p><code>allowSuperOutsideMethod</code>: <code>boolean</code></p></li> <li><p><code>plugins</code>: <code>PluginList</code></p></li> <li><p><code>strictMode</code>: <code>boolean</code></p></li> <li><p><code>ranges</code>: <code>boolean</code></p></li> <li><p><code>tokens</code>: <code>boolean</code></p></li> <li><p><code>createParenthesizedExpressions</code>: <code>boolean</code></p></li> <li><p><code>errorRecovery</code>: <code>boolean</code></p></li></ul></li> <li><p><code>inModule</code></p></li> <li><p><code>scope</code></p></li> <li><p><code>classScope</code></p></li> <li><p><code>expressionScope</code></p></li> <li><p><code>prodParam</code></p></li> <li><p><code>plugins</code></p></li> <li><p><code>filename</code></p></li> <li><p><code>exportedIdentifiers</code></p></li> <li><p><code>sawUnambiguousESM</code></p></li> <li><p><code>ambiguousScriptDifferentAst</code></p></li> <li><p><code>state</code></p></li> <li><p><code>input</code></p></li> <li><p><code>length</code></p> <p>用于获取 <code>input</code> 的长度，因为 <code>input</code> 会比较长，考虑到性能优化，要获取其长度，Babel 会尽量避免直接获取其长度，而是单独维护一个 length。</p></li></ul></li> <li><p>方法</p> <ul><li><p><code>hasPlugin()</code></p></li> <li><p><code>getPluginOption()</code></p></li></ul></li></ul> <h4 id="commentsparser"><a href="#commentsparser" class="header-anchor">#</a> <code>CommentsParser</code></h4> <p>提供针对注释的各种处理工具。</p> <h4 id="parsererrors"><a href="#parsererrors" class="header-anchor">#</a> <code>ParserErrors</code></h4> <p>提供了对错误的统一处理工具，并集成了词法分析、语法分析过程中的所有可能出现的错误情况。</p> <ul><li><p><code>ParserErrors</code> 对外提供了一些工具对象</p> <ul><li><p><code>ErrorCodes</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> ErrorCodes <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">SyntaxError</span><span class="token operator">:</span> <span class="token string">&quot;BABEL_PARSER_SYNTAX_ERROR&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">SourceTypeModuleError</span><span class="token operator">:</span> <span class="token string">&quot;BABEL_PARSER_SOURCETYPE_MODULE_REQUIRED&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>ParsingError</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type ErrorContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">pos</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
    <span class="token literal-property property">loc</span><span class="token operator">:</span> Position<span class="token punctuation">,</span>
    missingPlugin<span class="token operator">?</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    code<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    reasonCode<span class="token operator">?</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> type ParsingError <span class="token operator">=</span> SyntaxError <span class="token operator">&amp;</span> ErrorContext<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>ErrorTemplate</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> type ErrorTemplate <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> ErrorCode<span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token literal-property property">reasonCode</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>makeErrorTemplates()</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">makeErrorTemplates</span><span class="token punctuation">(</span>
    <span class="token parameter"><span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> ErrorCode<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> ErrorTemplates 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>Errors / SourceTypeModuleErrors</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span>
    ErrorMessages <span class="token keyword">as</span> Errors<span class="token punctuation">,</span>
    SourceTypeModuleErrorMessages <span class="token keyword">as</span> SourceTypeModuleErrors<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./error-message&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// error-message</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> SourceTypeModuleErrorMessages <span class="token operator">=</span> <span class="token function">makeErrorTemplates</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">ImportMetaOutsideModule</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import.meta may appear only with 'sourceType: &quot;module&quot;'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">ImportOutsideModule</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'import' and 'export' may appear only with 'sourceType: &quot;module&quot;'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/* code */</span> ErrorCodes<span class="token punctuation">.</span>SourceTypeModuleError<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> ErrorMessages <span class="token operator">=</span> <span class="token function">makeErrorTemplates</span><span class="token punctuation">(</span>
<span class="token punctuation">{</span>
    <span class="token literal-property property">AccessorIsGenerator</span><span class="token operator">:</span> <span class="token string">&quot;A %0ter cannot be a generator.&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ArgumentsInClass</span><span class="token operator">:</span> <span class="token string">&quot;'arguments' is only allowed in functions and class methods.&quot;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> SyntaxError<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ul></li> <li><p>``ParserErrors` 集成了词法分析、语法分析过程的所有错误描述</p> <p>相较于 <code>ParserError</code> 对外暴露了哪些对象，更容易帮助我们理解转译过程的，是转译过程中会关注哪些错误。</p> <p><code>ParserError</code> 集成了如下错误:</p> <p>TODO</p></li></ul> <h3 id="位置信息"><a href="#位置信息" class="header-anchor">#</a> 位置信息</h3> <p>文件 <code>babel/packages/babel-parser/src/util/location.js</code> 定义了一系列和代码位置相关的对象和方法。</p> <ul><li><p><code>Position</code> 类</p> <p>描述了目标字符在源码的行列信息（<code>line/column</code>），它是一个基础的位置类。</p></li> <li><p><code>SourceLocation</code> 类（依赖 <code>Position</code> 类）</p> <p>描述了目标字符串在源码的开始位置（<code>start: Position</code>）和结束位置（<code>end: Position</code>）等信息。</p></li> <li><p><code>getLineInfo(input: string, offset: number): Position</code></p> <p>该方法用于临时获取目标字符串的位置信息。比如出于性能考虑关闭语法分析时检测代码的位置信息后，仍可以通过该方法临时获取目标字符在源码的位置信息。</p></li></ul> <h3 id="工具方法"><a href="#工具方法" class="header-anchor">#</a> 工具方法</h3> <ul><li><p>节点处理类（<code>node</code>）</p> <ul><li><code>startNode()</code></li> <li><code>startNodeAt()</code></li> <li><code>startNodeAtNode()</code></li> <li><code>finishNode()</code></li> <li><code>finishNodeAt()</code></li> <li><code>resetStartLocation()</code></li> <li><code>resetEndLocation()</code></li> <li><code>resetStartLocationFromNode()</code></li></ul></li> <li><p>校验类（<code>util</code>）</p> <ul><li><p><code>isRelational(op: &quot;&lt;&quot; | &quot;&gt;&quot;): boolean</code></p> <p>是 <code>&lt;</code> 或 <code>&gt;</code> 节点。</p></li> <li><p><code>isContextual(name: string): boolean</code></p></li> <li><p><code>isUnparsedContextual</code></p></li> <li><p><code>isLookaheadContextual</code></p></li> <li><p><code>expectRelational</code></p></li> <li><p><code>expectContextual</code></p></li> <li><p><code>canInsertSemicolon</code></p></li> <li><p><code>hasPrecedingLineBreak</code></p></li> <li><p><code>hasFollowingLineBreak</code></p></li> <li><p><code>isLineTerminator</code></p></li> <li><p><code>semicolon</code></p></li> <li><p><code>expect</code></p></li> <li><p><code>assertNoSpace</code></p></li> <li><p><code>unexpected</code></p></li> <li><p><code>expectPlugin</code></p></li> <li><p><code>expectOnePlugin</code></p></li> <li><p><code>tryParse</code></p></li> <li><p><code>checkExpressionErrors</code></p></li> <li><p><code>isLiteralPropertyName</code></p></li> <li><p><code>isPrivateName</code></p></li> <li><p><code>hasPropertyAsPrivateName</code></p></li> <li><p><code>isOptionalChain</code></p></li> <li><p><code>isObjectProperty</code></p></li> <li><p><code>isObjectMethod</code></p></li></ul></li> <li><p>操作类（<code>util</code>）</p> <ul><li><p><code>addExtra(node: Node, key: string, val: any)</code></p> <p>给 <code>node</code> 的 <code>extra</code> 添加属性: <code>key/val</code>。</p></li> <li><p><code>eatContextual</code></p></li> <li><p><code>getPrivateNameSV</code></p></li> <li><p><code>initializeScopes</code></p></li> <li><p><code>enterInitialScopes</code></p></li></ul></li></ul> <h3 id="保留字识别"><a href="#保留字识别" class="header-anchor">#</a> 保留字识别</h3> <p>文件 <code>babel/packages/babel-parser/src/util/identifier.js</code> 定义了关于标识符的相关对象和方法。</p> <p>该文件描述了以下单词会被认为是 JavaScript 保留字:</p> <ul><li><p>无条件保留字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">break</span> <span class="token operator">/</span> <span class="token keyword">case</span> <span class="token operator">/</span> catch <span class="token operator">/</span> <span class="token keyword">continue</span> <span class="token operator">/</span> <span class="token keyword">debugger</span> <span class="token operator">/</span> <span class="token keyword">default</span> <span class="token operator">/</span> <span class="token keyword">do</span> <span class="token operator">/</span> <span class="token keyword">else</span> <span class="token operator">/</span> finally <span class="token operator">/</span> <span class="token keyword">for</span> <span class="token operator">/</span> <span class="token keyword">function</span> <span class="token operator">/</span> <span class="token keyword">if</span> <span class="token operator">/</span> <span class="token keyword">return</span> <span class="token operator">/</span> <span class="token keyword">switch</span> <span class="token operator">/</span> <span class="token keyword">throw</span> <span class="token operator">/</span> <span class="token keyword">try</span> <span class="token operator">/</span> <span class="token keyword">var</span> <span class="token operator">/</span> <span class="token keyword">const</span> <span class="token operator">/</span> <span class="token keyword">while</span> <span class="token operator">/</span> <span class="token keyword">with</span> <span class="token operator">/</span> <span class="token keyword">new</span> <span class="token operator">/</span> <span class="token keyword">this</span> <span class="token operator">/</span> <span class="token keyword">super</span> <span class="token operator">/</span> <span class="token keyword">class</span> <span class="token operator">/</span> <span class="token keyword">extends</span> <span class="token operator">/</span> <span class="token keyword">export</span> <span class="token operator">/</span> <span class="token keyword">import</span> <span class="token operator">/</span> <span class="token keyword">null</span> <span class="token operator">/</span> <span class="token boolean">true</span> <span class="token operator">/</span> <span class="token boolean">false</span> <span class="token operator">/</span> <span class="token keyword">in</span> <span class="token operator">/</span> <span class="token keyword">instanceof</span> <span class="token operator">/</span> <span class="token keyword">typeof</span> <span class="token operator">/</span> <span class="token keyword">void</span> <span class="token operator">/</span> <span class="token keyword">delete</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>严格模式下的新增保留字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">implements</span> <span class="token operator">/</span> <span class="token keyword">interface</span> <span class="token operator">/</span> <span class="token keyword">let</span> <span class="token operator">/</span> <span class="token keyword">package</span> <span class="token operator">/</span> <span class="token keyword">private</span> <span class="token operator">/</span> <span class="token keyword">protected</span> <span class="token operator">/</span> <span class="token keyword">public</span> <span class="token operator">/</span> <span class="token keyword">static</span> <span class="token operator">/</span> <span class="token keyword">yield</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>strictBind</code> 下的新增保留字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>eval <span class="token operator">/</span> arguments
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>可能是保留字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">enum</span> <span class="token operator">/</span> <span class="token keyword">await</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>工具包 <code>@babel/helper-validator-identifier</code> 也定义了一系列工具方法，在程序中判断保留字信息。</p> <h3 id="作用域处理-scope"><a href="#作用域处理-scope" class="header-anchor">#</a> 作用域处理（<code>scope</code>）</h3> <ul><li><p>什么是作用域</p> <p>作用域是当前的执行上下文，也就是值和表达式在其中&quot;可见&quot;或可被访问到的上下文。如果一个值或表达式不在&quot;当前的作用域中&quot;，那么它就是不可用的。</p> <p>我们知道，JavaScript 中存在三种作用域: 全局作用域、函数作用域、块级作用域。并且，JavaScript 是静态作用域，也就是在静态代码解析的时候，作用域已经确认了，因此，Babel 这样的工具也可以针对作用域做一些转译工作。</p> <p>Babel 针对这几种作用域做了更细致的划分，在文件 <code>babel/packages/babel-parser/src/util/scopeflags.js</code> 定义了一系列的作用域:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> type ScopeFlags <span class="token operator">=</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_OTHER</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_PROGRAM</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_FUNCTION</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_VAR</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_ARROW</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_SIMPLE_CATCH</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_SUPER</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_DIRECT_SUPER</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_CLASS</span>
<span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">SCOPE_STATIC_BLOCK</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>笔者整理了 Babel 定义的作用域和 JavaScript 作用域之间的关系:</p> <ul><li><p>全局作用域: <code>SCOPE_PROGRAM</code></p></li> <li><p>函数作用域: <code>SCOPE_FUNCTION</code></p> <p>箭头函数和普通函数。</p></li> <li><p>块级作用域</p> <ul><li><p><code>SCOPE_VAR</code></p></li> <li><p><code>SCOPE_ARROW</code></p> <p>箭头函数</p></li> <li><p><code>SCOPE_SIMPLE_CATCH</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这个区域</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>SCOPE_SUPER</code></p></li> <li><p><code>SCOPE_DIRECT_SUPER</code></p></li> <li><p><code>SCOPE_CLASS</code></p></li> <li><p><code>SCOPE_STATIC_BLOCK</code></p></li> <li><p><code>SCOPE_OTHER</code></p> <ul><li><code>ForStatement</code></li> <li><code>SwitchStatement</code></li> <li><code>TryStatement</code></li> <li><code>Block</code></li></ul></li></ul></li></ul></li> <li><p>作用域栈</p> <p>文件 <code>babel/packages/babel-parser/src/util/scope.js</code> 描述了 Babel 对作用域的各种处理。</p> <p>其中，该文件定义的 <code>Scope</code> 类维护了一个&quot;作用域栈&quot;（<code>scopeStack</code>），并提供了入栈方法 <code>enter()</code> 和出栈方法 <code>exit()</code>，如图:</p> <p>TODO</p> <p>当 Babel 解析表达式（<code>expression</code>）、语句（<code>statement</code>）等节点时，会频繁地通过递归方式进行节点解析的工作，TODO</p> <p>每进入一个新的节点解析时，一个新的 <code>scope</code> 作用域对象会入栈，在该新节点解析的过程中的上下文均以入栈的这个作用域对象为准，待新节点解析完毕，之前入栈的作用域对象就出栈。</p></li> <li><p>3 种作用域</p> <ul><li><code>this.scope</code></li> <li><code>this.classScope</code></li> <li><code>this.expressionScope</code></li></ul></li> <li><p><code>scope.js</code></p> <p>文件 <code>babel/packages/babel-parser/src/util/scope.js</code> 描述了 Babel 对作用域的各种工具属性和方法。</p> <p>不同的应用场景有不同的工具对应:</p> <ul><li><p><code>inFunction</code></p> <p>当前作用域处于某个函数体中。</p></li> <li><p><code>allowSuper</code></p> <p>当前作用域允许使用 <code>super()</code> 方法。</p></li> <li><p><code>allowDirectSuper</code></p> <p>当前作用有允许直接使用 <code>super()</code> 方法。</p></li> <li><p><code>inClass</code></p> <p>当前作用域处于 <code>class</code> 声明中。</p></li> <li><p><code>inClassAndNotInNonArrowFunction</code></p> <p>当前作用域位于 <code>class</code> 且是非箭头函数体中。</p></li> <li><p><code>inStaticBlock</code></p> <p>当前作用域位于 <code>statiBlock</code> 中。</p></li> <li><p><code>inNonArrowFunction</code></p> <p>当前作用域位于非箭头函数体中。</p></li> <li><p><code>treatFunctionsAsVar</code></p> <p>当前作用域位于中，函数是否可以被认为是 <code>var</code> 定义的函数对象。</p> <blockquote><p>从顶层作用域的角度看，函数声明可以被视为 <code>var</code> 定义的函数对象。</p></blockquote></li> <li><p><code>createScope()</code></p> <p>创建一个 <code>scope</code> 实例。</p></li> <li><p><code>enter()</code></p> <p>创建一个 <code>scope</code> 实例，并推入到 <code>scope</code> 栈。</p></li> <li><p><code>exit()</code></p> <p><code>scope</code> 栈推出。</p></li> <li><p><code>treatFunctionsAsVarInScope()</code></p> <p>同 <code>treatFunctionsAsVar()</code>。</p></li> <li><p><code>declareName()</code></p> <p>TODO</p></li> <li><p><code>maybeExportDefined()</code></p> <p>TODO</p></li> <li><p><code>checkRedeclarationInScope()</code></p> <p>检查是否重复定义，如果有，会抛出错误。</p></li> <li><p><code>isRedeclaredInScope()</code></p> <p>判断是否重复定义，如果有，不会抛出错误。</p></li> <li><p><code>checkLocalExport()</code></p> <p>TODO</p></li> <li><p><code>currentScope()</code></p> <p>获取 <code>scope</code> 栈顶项。</p></li> <li><p><code>currentVarScopeFlags()</code></p> <p>TODO</p></li> <li><p><code>currentThisScopeFlags()</code></p> <p>TODO</p></li></ul></li></ul> <h3 id="语句处理-statement"><a href="#语句处理-statement" class="header-anchor">#</a> 语句处理（<code>statement</code>）</h3> <p>文件 <code>babel/packages/babel-parser/src/statement.js</code> 描述了 Babel 对语句（<code>statement</code>）的各种处理。</p> <ul><li><p>生成语句节点</p> <p>首先看一下 statement 部分，解析了哪些 AST 节点:</p> <p>parseProgram --&gt; parseBlockBody --&gt; parseBlockOrModuleBlockBody --&gt; while body afterBlockParse</p> <p>这里列举了 <code>statement.js</code> 可以解析的节点列表:</p> <table><thead><tr><th>分类</th> <th>节点名称</th> <th>定义</th> <th>描述</th></tr></thead> <tbody><tr><td></td> <td><code>File</code></td> <td></td> <td></td></tr> <tr><td></td> <td><code>Program</code></td> <td>interface Program &lt;: Node {<br>  type: &quot;Program&quot;;<br>  interpreter: InterpreterDirective | null;<br>  sourceType: &quot;script&quot; | &quot;module&quot;;<br>  body: [ Statement | ModuleDeclaration ];<br>  directives: [ Directive ];<br>}</td> <td>根节点，AST顶部节点<br><br><code>body</code> 是一个数组，包括语句和模块声明<br><br>如果是 ES6 模块，必须指定 <code>sourceType</code> 为 <code>module</code>，否则指定为 <code>script</code></td></tr> <tr><td></td> <td><code>InterpreterDirective</code></td> <td>interface InterpreterDirective &lt;: StringLiteral {<br>  type: &quot;InterpreterDirective&quot;;<br>}</td> <td><code>#!</code>字面量</td></tr> <tr><td></td> <td><code>MemberExpression</code></td> <td>interface MemberExpression &lt;: Expression, Pattern {<br>  type: &quot;MemberExpression&quot;;<br>  object: Expression | Super;<br>  property: Expression | PrivateName;<br>  computed: boolean;<br>}</td> <td>成员表达式节点<br><br>表示引用对象成员，如 <code>obj.name</code> 或 <code>obj[&quot;name&quot;]</code><br><br>1. <code>object</code>: 表示对象表达式节点，如上例中的 <code>obj</code><br>2. <code>property</code>: 表示属性名称，如上例中的 <code>name</code><br>3. <code>computed</code>: 若为 <code>true</code>，表示 <code>obj[&quot;name&quot;]</code> 形式，<code>property</code> 需要为 <code>Expression</code> 节点；若为 <code>false</code>，表示 <code>obj.name</code> 形式，<code>property</code> 需要为 <code>Identifier</code> 节点</td></tr> <tr><td></td> <td><code>Decorator</code></td> <td>interface Decorator &lt;: Node {<br>  type: &quot;Decorator&quot;;<br>  expression: Expression;<br>}</td> <td>装饰器</td></tr> <tr><td></td> <td><code>CallExpression</code></td> <td>interface CallExpression &lt;: Expression {<br>  type: &quot;CallExpression&quot;;<br>  callee: Expression | Super | Import;<br>  arguments: [ Expression | SpreadElement ];<br>}</td> <td>函数调用表达式<br><br>如 <code>run(1, 2)</code> 这样的表达式。<br><br>1. <code>callee</code>: 表示函数，是表达式节点<br>2. <code>arguments</code>: 表示参数，为 <code>Expression</code> 或 <code>SpreadElement</code></td></tr> <tr><td></td> <td><code>BreakStatement</code></td> <td>interface BreakStatement &lt;: Statement {<br>  type: &quot;BreakStatement&quot;;<br>  label: Identifier | null;<br>}</td> <td>Break 语句<code>break [label?];</code></td></tr> <tr><td></td> <td><code>ContinueStatement</code></td> <td>interface ContinueStatement &lt;: Statement {<br>  type: &quot;ContinueStatement&quot;;<br>  label: Identifier | null;<br>}</td> <td>Continue 语句<br><br><code>continue [label?];</code></td></tr> <tr><td></td> <td><code>DebuggerStatement</code></td> <td>interface DebuggerStatement &lt;: Statement {<br>  type: &quot;DebuggerStatement&quot;;<br>}</td> <td>调试语句<br><br><code>debugger;</code></td></tr> <tr><td></td> <td><code>DoWhileStatement</code></td> <td>interface DoWhileStatement &lt;: Statement {<br>  type: &quot;DoWhileStatement&quot;;<br>  body: Statement;<br>  test: Expression;<br>}</td> <td>DoWhile语句<br><br><code>do {[test]} while ([body])</code></td></tr> <tr><td></td> <td><code>VariableDeclaration</code></td> <td>interface VariableDeclaration &lt;: Declaration {<br>  type: &quot;VariableDeclaration&quot;;<br>  declarations: [ VariableDeclarator ];<br>  kind: &quot;var&quot; | &quot;let&quot; | &quot;const&quot;;<br>}</td> <td>变量声明<br><br>如 <code>let a = 1;</code><br><br>1. <code>kind</code>: 表示是什么类型的声明<br>2. <code>declarations</code>: 表示声明的多个描述，比如 <code>let a = 1, b = 2;</code><br><br>例如: <br><br>1. <code>const a = 1</code><br>2. <code>let a = 1, b = 2</code></td></tr> <tr><td></td> <td><code>IfStatement</code></td> <td>interface IfStatement &lt;: Statement {<br>    type: &quot;IfStatement&quot;;<br>    test: Expression;<br>    consequent: Statement;<br>    alternate: Statement | null;<br>}</td> <td><code>if</code>语句<br><br><code>if ([test]) {[consequent]} else {[alternate]}</code><br><br>1. <code>test</code>表示<code>if (...)</code>括号中的表达式<br>2. <code>consequent</code>表示条件为 <code>true</code> 时的执行语句，通常是一个块语句<br>3. <code>alternate</code> 用来表示 <code>else</code> 后跟随的语句，通常也会是块语句，也可以又是一个 <code>if</code> 语句，例如 <code>else if (...)</code>，也可以是 <code>null</code></td></tr> <tr><td></td> <td><code>ReturnStatement</code></td> <td>interface ReturnStatement &lt;: Statement {<br>  type: &quot;ReturnStatement&quot;;<br>  argument: Expression | null;<br>}</td> <td>返回语句<br><br><code>return [argument]</code><br><br><code>argument</code> 为表达式或 null</td></tr> <tr><td></td> <td><code>SwitchCase</code></td> <td>interface SwitchCase &lt;: Node {<br>  type: &quot;SwitchCase&quot;;<br>  test: Expression | null;<br>  consequent: [ Statement ];<br>}</td> <td>SwitchCase节点<br><br><code>case: [test]: [consequent]</code></td></tr> <tr><td></td> <td><code>SwitchStatement</code></td> <td>interface SwitchStatement &lt;: Statement {<br>  type: &quot;SwitchStatement&quot;;<br>  discriminant: Expression;<br>  cases: [ SwitchCase ];<br>}</td> <td>switch语句<br><br><code>switch ([discriminant]) {[cases]}</code><br><br>1. <code>discriminant</code>: switch 后紧跟的表达式<br>2. <code>cases</code>: switchCase 节点数组</td></tr> <tr><td></td> <td><code>ThrowStatement</code></td> <td>interface ThrowStatement &lt;: Statement {<br>  type: &quot;ThrowStatement&quot;;<br>  argument: Expression;<br>}</td> <td>Throw语句<br><br><code>throw [argument]</code></td></tr> <tr><td></td> <td><code>CatchClause</code></td> <td>interface CatchClause &lt;: Node {<br>  type: &quot;CatchClause&quot;;<br>  param?: Pattern;<br>  body: BlockStatement;<br>}</td> <td>Catch从句节点<br><br>ES2019 允许 catch 从句为空：<code>try {} catch {}</code></td></tr> <tr><td></td> <td><code>TryStatement</code></td> <td>interface TryStatement &lt;: Statement {<br>  type: &quot;TryStatement&quot;;<br>  block: BlockStatement;<br>  handler: CatchClause | null;<br>  finalizer: BlockStatement | null;<br>}</td> <td>Try语句<br><br><code>try {[block]} catch {[handler]} finally {[finalizer]}</code></td></tr> <tr><td></td> <td><code>WhileStatement</code></td> <td>interface WhileStatement &lt;: Statement {<br>  type: &quot;WhileStatement&quot;;<br>  test: Expression;<br>  body: Statement;<br>}</td> <td>While语句<br><br><code>while ([test] {[body]}</code></td></tr> <tr><td></td> <td><code>WithStatement</code></td> <td>interface WithStatement &lt;: Statement {<br>  type: &quot;WithStatement&quot;;<br>  object: Expression;<br>  body: Statement;<br>}</td> <td>with 语句<br><br><code>with ([object]) {[body]}</code></td></tr> <tr><td></td> <td><code>EmptyStatement</code></td> <td>interface EmptyStatement &lt;: Statement {<br>  type: &quot;EmptyStatement&quot;;<br>}</td> <td>空语句<br><br><code>;</code></td></tr> <tr><td></td> <td><code>LabeledStatement</code></td> <td>interface LabeledStatement &lt;: Statement {<br>  type: &quot;LabeledStatement&quot;;<br>  label: Identifier;<br>  body: Statement;<br>}</td> <td>标签语句<br><br><code>loop: … break loop;</code></td></tr> <tr><td></td> <td><code>ExpressionStatement</code></td> <td>interface ExpressionStatement &lt;: Statement {<br>  type: &quot;ExpressionStatement&quot;;<br>  expression: Expression;<br>}</td> <td>表达式语句<br><br>如 <code>1 + 1</code></td></tr> <tr><td></td> <td><code>BlockStatement</code></td> <td>interface BlockStatement &lt;: Statement {<br>  type: &quot;BlockStatement&quot;;<br>  body: [ Statement ];<br>  directives: [ Directive ];<br>}</td> <td>块语句<br><br><code>{[body]}</code><br><br>例如：<code>if (...) { // 块语句部分 }</code><br><br>1. <code>body</code>: 内容节点列表<br>2. <code>directives</code>: ???</td></tr> <tr><td></td> <td><code>ForStatement</code></td> <td>interface ForStatement &lt;: Statement {<br>  type: &quot;ForStatement&quot;;<br>  init: VariableDeclaration | Expression | null;<br>  test: Expression | null;<br>  update: Expression | null;<br>  body: Statement;<br>}</td> <td>for 语句<br><br><code>for ([init];[test];[update]) {[body]}</code><br><br>1. <code>init/test/update</code>: 分别表示 <code>for</code> 语句括号中的三部分，分别为初始化值、循环判断条件、变量更新操作；三个均可以为 <code>null</code>，即 <code>for(;;){...}</code><br>2. <code>body</code>: 循环执行的语句</td></tr> <tr><td></td> <td><code>ForInStatement</code></td> <td>interface ForInStatement &lt;: Statement {<br>  type: &quot;ForInStatement&quot;;<br>  left: VariableDeclaration |  Expression;<br>  right: Expression;<br>  body: Statement;<br>}</td> <td>ForIn 语句<br><br><code>for ([left] in [right]) {[body]}</code></td></tr> <tr><td></td> <td><code>ForOfStatement</code></td> <td>interface ForOfStatement &lt;: ForInStatement {<br>  type: &quot;ForOfStatement&quot;;<br>  await: boolean;<br>}</td> <td>ForOf 语句<br><br><code>for (let [left] of [right])</code><br><br><code>await</code> 表示是否为异步迭代器 <code>for-await-of</code>: <code>for await (const x of obj) {}</code></td></tr> <tr><td></td> <td><code>VariableDeclarator</code></td> <td>interface VariableDeclarator &lt;: Node {<br>    type: &quot;VariableDeclarator&quot;;<br>    id: Pattern;<br>    init: Expression | null;<br>}</td> <td>变量声明的描述<br><br>1. <code>id</code> 表示变量名称节点<br>2. <code>init</code> 表示初始值的表达式，可以为 <code>null</code><br><br>例如: <br><br><code>a = 1</code></td></tr> <tr><td></td> <td><code>ClassDeclaration</code></td> <td>interface ClassDeclaration &lt;: Class, Declaration {<br>  type: &quot;ClassDeclaration&quot;;<br>  id: Identifier;<br>}</td> <td>类声明<br><br><code>class [name] [extends] {[body]}</code></td></tr> <tr><td></td> <td><code>ClassExpression</code></td> <td>interface ClassExpression &lt;: Class, Expression {<br>  type: &quot;ClassExpression&quot;;<br>}</td> <td>类表达式<br><br><code>const MyClass = class [className] [extends otherClassName] { ... }</code></td></tr> <tr><td></td> <td><code>ClassBody</code></td> <td>interface ClassBody &lt;: Node {<br>  type: &quot;ClassBody&quot;;<br>  body: [ <br>    ClassMethod | <br>    ClassPrivateMethod | <br>    ClassProperty | <br>    ClassPrivateProperty | <br>    StaticBlock <br>  ];<br>}</td> <td></td></tr> <tr><td></td> <td><code>ClassPrivateProperty</code></td> <td>interface ClassPrivateProperty &lt;: Node {<br>  type: &quot;ClassPrivateProperty&quot;;<br>  key: PrivateName;<br>  value: Expression;<br>  static: boolean;<br>}</td> <td></td></tr> <tr><td></td> <td><code>ClassProperty</code></td> <td>interface ClassProperty &lt;: Node {<br>  type: &quot;ClassProperty&quot;;<br>  key: Expression;<br>  value: Expression;<br>  static: boolean;<br>  computed: boolean;<br>}</td> <td></td></tr> <tr><td></td> <td><code>ExportAllDeclaration</code></td> <td>interface ExportAllDeclaration &lt;: ModuleDeclaration {<br>  type: &quot;ExportAllDeclaration&quot;;<br>  source: StringLiteral;<br>  assertions?: [ ImportAttribute ];<br>}</td> <td>全部导出声明<br><br>如 <code>export * from './a'</code></td></tr> <tr><td></td> <td><code>ExportNamedDeclaration</code></td> <td>interface ExportNamedDeclaration &lt;: ModuleDeclaration {<br>  type: &quot;ExportNamedDeclaration&quot;;<br>  declaration: Declaration | null;<br>  specifiers: [ ExportSpecifier ];<br>  source: StringLiteral | null;<br>  assertions?: [ ImportAttribute ];<br>}</td> <td>导出具名声明<br><br>如：<code>export { x, y as z }</code>、<code>export var a = 1</code>、<code>export { x } from 'a'</code></td></tr> <tr><td></td> <td><code>ExportDefaultDeclaration</code></td> <td>interface ExportDefaultDeclaration &lt;: <br>ModuleDeclaration {<br>  type: &quot;ExportDefaultDeclaration&quot;;<br>  declaration: <br>    OptFunctionDeclaration | <br>    OptClassDeclaration | <br>    Expression;<br>}</td> <td>默认导出声明<br><br>如 <code>export default a</code></td></tr> <tr><td></td> <td><code>ExportDefaultSpecifier</code></td> <td></td> <td></td></tr> <tr><td></td> <td><code>ExportNamespaceSpecifier</code></td> <td></td> <td></td></tr> <tr><td></td> <td><code>ExportSpecifier</code></td> <td>interface ExportSpecifier &lt;: ModuleSpecifier {<br>  type: &quot;ExportSpecifier&quot;;<br>  exported: Identifier | StringLiteral;<br>  local?: Identifier | StringLiteral;<br>}</td> <td>导出说明符<br><br>如 <code>export { a }</code>、<code>export { a as b }</code></td></tr> <tr><td></td> <td><code>ImportDeclaration</code></td> <td>interface ImportDeclaration &lt;: ModuleDeclaration {<br>  type: &quot;ImportDeclaration&quot;;<br>  importKind: null | &quot;type&quot; | &quot;typeof&quot; | &quot;value&quot;;<br>  specifiers: [ <br>    ImportSpecifier | <br>    ImportDefaultSpecifier | <br>    ImportNamespaceSpecifier <br>  ];<br>  source: StringLiteral;<br>  assertions?: [ ImportAttribute ];<br>}</td> <td>import 声明<br><br>如 <code>import a from &quot;./a&quot;</code></td></tr> <tr><td></td> <td><code>ImportDefaultSpecifier</code></td> <td>interface ImportDefaultSpecifier &lt;: ModuleSpecifier {<br>  type: &quot;ImportDefaultSpecifier&quot;;<br>}</td> <td>默认导入说明符<br><br>如 <code>import a from &quot;./a&quot;</code></td></tr> <tr><td></td> <td><code>ImportNamespaceSpecifier</code></td> <td>interface ImportNamespaceSpecifier &lt;: ModuleSpecifier {<br>  type: &quot;ImportNamespaceSpecifier&quot;;<br>}</td> <td>命名空间导入说明符<br><br>如 <code>import * as a from &quot;./a&quot;</code></td></tr> <tr><td></td> <td><code>ImportAttribute</code></td> <td>interface ImportAttribute &lt;: Node {<br>  type: &quot;ImportAttribute&quot;;<br>  key: Identifier;<br>  value: StringLiteral;<br>}</td> <td></td></tr> <tr><td></td> <td><code>ImportSpecifier</code></td> <td>interface ImportSpecifier &lt;: ModuleSpecifier {<br>  type: &quot;ImportSpecifier&quot;;<br>  imported: Identifier | StringLiteral;<br>}</td> <td>导入说明符<br><br>如 <code>import { a as b } from &quot;./a&quot;</code></td></tr></tbody></table></li> <li><p>校验AST节点</p> <ul><li><code>isLet</code></li> <li><code>isLetKeyword</code></li> <li><code>isValidDirective</code></li> <li><code>isExportDefaultSpecifier</code></li> <li><code>isThisParam</code></li> <li><code>canHaveLeadingDecorator</code></li> <li><code>assertModuleNodeAllowed</code></li> <li><code>verifyBreakContinue</code></li> <li><code>shouldParseExportDeclaration</code></li> <li><code>checkExport</code></li> <li><code>checkDeclaration</code></li> <li><code>checkDuplicateExports</code></li></ul></li></ul> <h3 id="表达式处理-expression"><a href="#表达式处理-expression" class="header-anchor">#</a> 表达式处理（<code>expression</code>）</h3> <p>文件 <code>babel/packages/babel-parser/src/statement.js</code> 描述了 Babel 对语句（statement）的各种处理。</p> <ul><li><p>生成表达式节点</p> <table><thead><tr><th>分类</th> <th>节点名称</th> <th>定义</th> <th>描述</th></tr></thead> <tbody><tr><td></td> <td><code>SequenceExpression</code></td> <td>interface SequenceExpression &lt;: Expression {<br>  type: &quot;SequenceExpression&quot;;<br>  expressions: [ Expression ];<br>}</td> <td>Sequence 表达式<br><br>如 <code>1, 2, 3</code></td></tr> <tr><td></td> <td><code>AssignmentExpression</code></td> <td>interface AssignmentExpression &lt;: Expression {<br>  type: &quot;AssignmentExpression&quot;;<br>  operator: AssignmentOperator;<br>  left: Pattern | Expression;<br>  right: Expression;<br>}</td> <td>赋值表达式节点<br><br>1. <code>operator</code>: 赋值运算符<br>2. <code>left/right</code>: 赋值运算符左右的表达式<br>3. <code>left</code>: ???</td></tr> <tr><td></td> <td><code>ConditionalExpression</code></td> <td>interface ConditionalExpression &lt;: Expression {<br>  type: &quot;ConditionalExpression&quot;;<br>  test: Expression;<br>  alternate: Expression;<br>  consequent: Expression;<br>}</td> <td>条件表达式<br><br>就是三元运算表达式，即 <code>a &gt; b ? c : d</code></td></tr> <tr><td></td> <td><code>LogicalExpression</code></td> <td>interface LogicalExpression &lt;: Expression {<br>  type: &quot;LogicalExpression&quot;;<br>  operator: LogicalOperator;<br>  left: Expression;<br>  right: Expression;<br>}</td> <td>逻辑运算表达式<br><br>如 <code>a &amp;&amp; b</code></td></tr> <tr><td></td> <td><code>BinaryExpression</code></td> <td>interface BinaryExpression &lt;: Expression {<br>  type: &quot;BinaryExpression&quot;;<br>  operator: BinaryOperator;<br>  left: Expression | PrivateName;<br>  right: Expression;<br>}</td> <td>二元运算表达式<br><br>如 <code>a &gt; b</code><br><br>1. <code>left/right</code>: 运算符左右的表达式<br>2. <code>operator</code>: 二元运算符节点<br>3. <code>left</code>: 还可以是 <code>PrivateName</code> 节点</td></tr> <tr><td></td> <td><code>UnaryExpression</code></td> <td>interface UnaryExpression &lt;: Expression {<br>  type: &quot;UnaryExpression&quot;;<br>  operator: UnaryOperator;<br>  prefix: boolean;<br>  argument: Expression;<br>}</td> <td>一元表达式<br><br>如 <code>typeof 1</code></td></tr> <tr><td></td> <td><code>UpdateExpression</code></td> <td>interface UpdateExpression &lt;: Expression {<br>  type: &quot;UpdateExpression&quot;;<br>  operator: UpdateOperator;<br>  argument: Expression;<br>  prefix: boolean;<br>}</td> <td>Update 表达式<br><br>如 <code>++a</code><br><br>1. <code>operator</code>: <code>UpdateOperator</code> 节点，即 <code>++/--</code><br>2. <code>argument</code>: 参数<br>3. <code>prefix</code>: 表示 <code>operator</code> 是否在前</td></tr> <tr><td></td> <td><code>OptionalMemberExpression</code></td> <td>interface OptionalMemberExpression &lt;: Expression {<br>  type: &quot;OptionalMemberExpression&quot;;<br>  object: Expression;<br>  property: Expression | PrivateName;<br>  computed: boolean;<br>  optional: boolean;<br>}</td> <td>可选链表达式<br><br><code>a?.b?.c</code></td></tr> <tr><td></td> <td><code>MemberExpression</code></td> <td>interface MemberExpression &lt;: Expression, Pattern {<br>  type: &quot;MemberExpression&quot;;<br>  object: Expression | Super;<br>  property: Expression | PrivateName;<br>  computed: boolean;<br>}</td> <td>成员表达式节点<br><br>表示引用对象成员，如 <code>obj.name</code> 或 <code>obj[&quot;name&quot;]</code><br><br>1. <code>object</code>: 表示对象表达式节点，如上例中的 <code>obj</code><br>2. <code>property</code>: 表示属性名称，如上例中的 <code>name</code><br>3. <code>computed</code>: 若为 <code>true</code>，表示 <code>obj[&quot;name&quot;]</code> 形式，<code>property</code> 需要为 <code>Expression</code> 节点；若为 <code>false</code>，表示 <code>obj.name</code> 形式，<code>property</code> 需要为 <code>Identifier</code> 节点</td></tr> <tr><td></td> <td><code>BindExpression</code></td> <td>interface BindExpression &lt;: Expression {<br>    type: &quot;BindExpression&quot;;<br>    object: Expression | null;<br>    callee: Expression;<br>}</td> <td></td></tr> <tr><td></td> <td><code>TaggedTemplateExpression</code></td> <td>interface TaggedTemplateExpression &lt;: Expression {<br>  type: &quot;TaggedTemplateExpression&quot;;<br>  tag: Expression;<br>  quasi: TemplateLiteral;<br>}</td> <td>带标签的模板字符串表达式<br><br>function tagFunc(...args) {<br>  return args;<br>}<br>const setting = 'dark mode';<br>console.log(tagFunc`Setting ${ setting } is ${ value }!`);</td></tr> <tr><td></td> <td><code>OptionalCallExpression</code></td> <td>interface OptionalCallExpression &lt;: Expression {<br>  type: &quot;OptionalCallExpression&quot;;<br>  callee: Expression;<br>  arguments: [ Expression | SpreadElement ];<br>  optional: boolean;<br>}</td> <td>可选执行方法节点<br>如<code>f?.()()</code>中的<code>?.()</code></td></tr> <tr><td></td> <td><code>CallExpression</code></td> <td>interface CallExpression &lt;: Expression {<br>  type: &quot;CallExpression&quot;;<br>  callee: Expression | Super | Import;<br>  arguments: [ Expression | SpreadElement ];<br>}</td> <td>函数调用表达式<br><br>如 <code>run(1, 2)</code> 这样的表达式。<br><br>1. <code>callee</code>: 表示函数，是表达式节点<br>2. <code>arguments</code>: 表示参数，为 <code>Expression</code> 或 <code>SpreadElement</code></td></tr> <tr><td></td> <td><code>Import</code></td> <td>interface Import &lt;: Node {<br>    type: &quot;Import&quot;;<br>}</td> <td>Import 表达式<br><br><code>import * from './a'</code></td></tr> <tr><td></td> <td><code>ThisExpression</code></td> <td>interface ThisExpression &lt;: Expression {<br>  type: &quot;ThisExpression&quot;;<br>}</td> <td>This表达式<br><br><code>this</code></td></tr> <tr><td></td> <td><code>PipelinePrimaryTopicReference</code></td> <td></td> <td></td></tr> <tr><td></td> <td><code>DoExpression</code></td> <td>interface DoExpression &lt;: Expression {<br>  type: &quot;DoExpression&quot;;<br>  body: BlockStatement;<br>}</td> <td>do表达式<br><br><code>do&amp;nbsp;{&amp;nbsp;...&amp;nbsp;}</code></td></tr> <tr><td></td> <td><code>Super</code></td> <td>interface Super &lt;: Node {<br>    type: &quot;Super&quot;;<br>}</td> <td>Super 表达式<br><br><code>super([arguments])</code></td></tr> <tr><td></td> <td><code>PrivateName</code></td> <td>interface PrivateName &lt;: Node {<br>  type: &quot;PrivateName&quot;;<br>  id: Identifier;<br>}</td> <td>表示私有的标识符</td></tr> <tr><td></td> <td><code>MetaProperty</code></td> <td>interface MetaProperty &lt;: Expression {<br>  type: &quot;MetaProperty&quot;;<br>  meta: Identifier;<br>  property: Identifier;<br>}</td> <td>元属性<br><br><code>new.target</code></td></tr> <tr><td></td> <td><code>StringLiteral</code></td> <td>interface StringLiteral &lt;: Literal {<br>  type: &quot;StringLiteral&quot;;<br>  value: string;<br>}</td> <td>字符串字面量</td></tr> <tr><td></td> <td><code>NumericLiteral</code></td> <td>interface NumericLiteral &lt;: Literal {<br>  type: &quot;NumericLiteral&quot;;<br>  value: number;<br>}</td> <td>数字字面量</td></tr> <tr><td></td> <td><code>BigIntLiteral</code></td> <td>interface BigIntLiteral &lt;: Literal {<br>  type: &quot;BigIntLiteral&quot;;<br>  value: string;<br>}</td> <td>BigInt 字面量</td></tr> <tr><td></td> <td><code>DecimalLiteral</code></td> <td>interface DecimalLiteral &lt;: Literal {<br>  type: &quot;DecimalLiteral&quot;;<br>  value: string;<br>}</td> <td></td></tr> <tr><td></td> <td><code>RegExpLiteral</code></td> <td>interface RegExpLiteral &lt;: Literal {<br>  type: &quot;RegExpLiteral&quot;;<br>  pattern: string;<br>  flags: string;<br>}</td> <td>正则字面量<br><br>1. <code>pattern</code>: 正则表达式内容字符，如 <code>/a/i</code> 中的<code>&quot;a&quot;</code><br>2. <code>flags</code>: <code>i</code>、<code>g</code>等标志</td></tr> <tr><td></td> <td><code>BooleanLiteral</code></td> <td>interface BooleanLiteral &lt;: Literal {<br>  type: &quot;BooleanLiteral&quot;;<br>  value: boolean;<br>}</td> <td>布尔值字面量</td></tr> <tr><td></td> <td><code>NullLiteral</code></td> <td>interface NullLiteral &lt;: Literal {<br>  type: &quot;NullLiteral&quot;;<br>}</td> <td>null 字面量</td></tr> <tr><td></td> <td><code>SequenceExpression</code></td> <td>interface SequenceExpression &lt;: Expression {<br>  type: &quot;SequenceExpression&quot;;<br>  expressions: [ Expression ];<br>}</td> <td>Sequence 表达式<br><br>如 <code>1, 2, 3</code></td></tr> <tr><td></td> <td><code>ParenthesizedExpression</code></td> <td>interface ParenthesizedExpression &lt;: Expression {<br>    type &quot;ParenthesizedExpression&quot;;<br>    expression: Expression;<br>}</td> <td>括号表达式</td></tr> <tr><td></td> <td><code>NewExpression</code></td> <td>interface NewExpression &lt;: CallExpression {<br>  type: &quot;NewExpression&quot;;<br>}</td> <td><code>new</code> 表达式<br><br>如<code>new Date()</code></td></tr> <tr><td></td> <td><code>TemplateElement</code></td> <td>interface TemplateElement &lt;: Node {<br>  type: &quot;TemplateElement&quot;;<br>  tail: boolean;<br>  value: {<br>    cooked: string | null;<br>    raw: string;<br>  };<br>}</td> <td>模板元素</td></tr> <tr><td></td> <td><code>TemplateLiteral</code></td> <td>interface TemplateLiteral &lt;: Expression {<br>  type: &quot;TemplateLiteral&quot;;<br>  quasis: [ TemplateElement ];<br>  expressions: [ Expression ];<br>}</td> <td>模板字面量<br><br><code>Hello ${name}</code></td></tr> <tr><td></td> <td><code>ObjectExpression</code></td> <td>interface ObjectExpression &lt;: Expression {<br>  type: &quot;ObjectExpression&quot;;<br>  properties: [ <br>    ObjectProperty | <br>    ObjectMethod | <br>    SpreadElement <br>  ];<br>}</td> <td>Object表达式<br><br>如 <code>&quot;{ a: 1 }&quot;</code><br><br><code>properties</code> 为数组，每个元素可以是： <br>1. <code>ObjectProperty</code> 节点<br>2. <code>ObjectMethod</code> 节点<br>3. <code>SpreadElement</code> 节点</td></tr> <tr><td></td> <td><code>ObjectPattern</code></td> <td>interface AssignmentProperty &lt;: ObjectProperty {<br>  value: Pattern;<br>}<br><br>interface ObjectPattern &lt;: Pattern {<br>  type: &quot;ObjectPattern&quot;;<br>  properties: [ AssignmentProperty | RestElement ];<br>}</td> <td></td></tr> <tr><td></td> <td><code>RecordExpression</code></td> <td>interface RecordExpression &lt;: Expression {<br>  type: &quot;RecordExpression&quot;;<br>  properties: [ <br>    ObjectProperty | <br>    ObjectMethod | <br>    SpreadElement <br>  ];<br>}</td> <td>Record表达式，如<code>#{ a: 1, b: '2' }</code></td></tr> <tr><td></td> <td><code>RestElement</code></td> <td>interface RestElement &lt;: Pattern {<br>  type: &quot;RestElement&quot;;<br>  argument: Pattern;<br>}</td> <td><code>fun(…args) {}</code></td></tr> <tr><td></td> <td><code>ObjectProperty</code></td> <td>interface ObjectProperty &lt;: ObjectMember {<br>  type: &quot;ObjectProperty&quot;;<br>  shorthand: boolean;<br>  value: Expression;<br>}</td> <td>属性节点</td></tr> <tr><td></td> <td><code>TupleExpression</code></td> <td>interface TupleExpression &lt;: Expression {<br>  type: &quot;TupleExpression&quot;;<br>  elements: [ Expression | SpreadElement | null ];<br>}</td> <td></td></tr> <tr><td></td> <td><code>ArrayExpression</code></td> <td>interface ArrayExpression &lt;: Expression {<br>  type: &quot;ArrayExpression&quot;;<br>  elements: [ Expression | SpreadElement | null ];<br>}</td> <td>数组表达式<br><br>如 <code>&quot;[1, 2, 3]&quot;</code><br><br><code>elements</code> 为数组，表示数组的多个元素，每个元素为表达式或 <code>null</code></td></tr> <tr><td></td> <td><code>ArrowFunctionExpression</code></td> <td>interface ArrowFunctionExpression &lt;: <br>Function, Expression {<br>  type: &quot;ArrowFunctionExpression&quot;;<br>  body: BlockStatement | Expression;<br>}</td> <td>箭头函数表达式<br><br><code>() =&gt; {[body]}</code></td></tr> <tr><td></td> <td><code>ArgumentPlaceholder</code></td> <td>interface ArgumentPlaceholder &lt;: Node {<br>    type: &quot;ArgumentPlaceholder&quot;;<br>}</td> <td></td></tr> <tr><td></td> <td><code>Identifier</code></td> <td>interface Identifier &lt;: Expression, Pattern {<br>    type: &quot;Identifier&quot;;<br>    name: string;<br>}</td> <td>标识符<br><br>即自定义名称，如变量名、属性名、函数名<br><br>一个标识符可以是一个表达式(<code>Expression</code>)，或者是解构(<code>Pattern</code>)</td></tr> <tr><td></td> <td><code>AwaitExpression</code></td> <td>interface AwaitExpression &lt;: Expression {<br>  type: &quot;AwaitExpression&quot;;<br>  argument: Expression | null;<br>}</td> <td>Await 表达式<br><br><code>await [argument]</code></td></tr> <tr><td></td> <td><code>YieldExpression</code></td> <td>interface YieldExpression &lt;: Expression {<br>  type: &quot;YieldExpression&quot;;<br>  argument: Expression | null;<br>  delegate: boolean;<br>}</td> <td>Yield 表达式<br><br><code>yield [argument]</code></td></tr> <tr><td></td> <td><code>PipelineBareFunction</code></td> <td></td> <td></td></tr> <tr><td></td> <td><code>PipelineTopicExpression</code></td> <td></td> <td></td></tr> <tr><td></td> <td><code>ModuleExpression</code></td> <td></td> <td></td></tr></tbody></table></li> <li><p>校验AST节点</p> <ul><li><code>checkProto()</code></li> <li><code>checkGetterSetterParams()</code></li> <li><code>checkParams()</code></li> <li><code>checkReservedWord()</code></li> <li><code>atPossibleAsyncArrow()</code></li> <li><code>shouldParseAsyncArrow()</code></li> <li><code>maybeAsyncOrAccessorProp()</code></li> <li><code>isSimpleParamList()</code></li> <li><code>isAwaitAllowed()</code></li> <li><code>isAmbiguousAwait()</code></li> <li><code>isSimpleReference()</code></li> <li><code>withTopicPermittingContext()</code></li></ul></li> <li><p>转换AST节点</p> <ul><li><code>toReferencedArguments()</code></li></ul></li></ul> <h3 id="左值处理-lval"><a href="#左值处理-lval" class="header-anchor">#</a> 左值处理（<code>lval</code>）</h3> <p>文件 <code>babel/packages/babel-parser/src/lvel.js</code> 描述了 Babel 对左值（ <code>lval</code> ）的各种处理。</p> <ul><li><p>生成的左值节点</p> <table><thead><tr><th>分类</th> <th>节点名称</th> <th>定义</th> <th>描述</th></tr></thead> <tbody><tr><td></td> <td><code>SpreadElement</code></td> <td>interface SpreadElement &lt;: Node {<br>  type: &quot;SpreadElement&quot;;<br>  argument: Expression;<br>}</td> <td>Spread 表达式<br><br>如 <code>[a, …b]</code></td></tr> <tr><td></td> <td><code>RestElement</code></td> <td>interface RestElement &lt;: Pattern {<br>  type: &quot;RestElement&quot;;<br>  argument: Pattern;<br>}</td> <td><code>fun(…args) {}</code></td></tr> <tr><td></td> <td><code>ArrayPattern</code></td> <td>interface ArrayPattern &lt;: Pattern {<br>  type: &quot;ArrayPattern&quot;;<br>  elements: [ Pattern | null ];<br>}</td> <td><code>[ name, age ] = [ 'Jack', 13 ]</code></td></tr> <tr><td></td> <td><code>AssignmentPattern</code></td> <td>interface AssignmentPattern &lt;: Pattern {<br>  type: &quot;AssignmentPattern&quot;;<br>  left: Pattern;<br>  right: Expression;<br>}</td> <td><code>fun(a = 10) {}</code></td></tr></tbody></table></li> <li><p>校验AST节点</p> <ul><li><code>isAssignable()</code></li> <li><code>checkLVal()</code></li> <li><code>checkToRestConversion()</code></li> <li><code>checkCommaAfterRest()</code></li></ul></li> <li><p>转换AST节点</p> <ul><li><code>toAssignable()</code></li> <li><code>toAssignableObjectExpressionProp()</code></li> <li><code>toAssignableList()</code></li> <li><code>toReferencedList()</code></li> <li><code>toReferencedListDeep()</code></li></ul></li></ul> <h3 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h3> <p>Babel 除了能够正确的进行语法分析和语义分析之外，错误扫描也是必不可少的工作。如果难以直观地梳理出 Babel 在语法分析和语义分析的各种细节逻辑的话，通过分析源码中的错误扫描部分，也可以帮助我们理解其分析逻辑。</p> <p>笔者梳理了 <code>babel/packages/babel-parser/</code> 下出现过的报错，以文件为单位分别介绍各自定义的错误。</p> <p>另外，所有错误的描述，定义为在 3 个对象上:</p> <ul><li><code>babel-parser/src/parser/error-message.js</code> 的 <code>ErrorMessages</code>，使用时重命名为 <code>Errors</code></li> <li><code>babel-parser/src/parser/error-message.js</code> 的 <code>SourceTypeModuleErrorMessages</code>，使用时重命名为 <code>SourceTypeModuleErrors</code></li> <li><code>babel-parser/src/plugins/jsx/index.js</code> 的 <code>JsxErrors</code>，使用时继续用 <code>JsxErrors</code></li></ul> <p>以下是 Babel 在解析 AST 节点过程中会抛出的错误。</p> <h4 id="语句类错误-statement-js"><a href="#语句类错误-statement-js" class="header-anchor">#</a> 语句类错误（<code>statement.js</code>）</h4> <ul><li><p><code>export</code> 的对象未定义</p> <p><code>Errors.ModuleExportUndefined</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Export <span class="token string">'%0'</span> is not defined.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>案例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>babel<span class="token punctuation">.</span><span class="token function">transformSync</span><span class="token punctuation">(</span><span class="token string">'export { a }'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">parserOpts</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">allowUndeclaredExports</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>会抛出错误:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Export <span class="token string">'a'</span> is not defined.

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span>
    <span class="token operator">|</span>          ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>在严格模式下，函数必须声明在顶层作用域或者块级作用域下</p> <p><code>Errors.StrictFunction</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>In strict mode code, functions can only be declared at <span class="token function">top</span> level or inside a block.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Babel 在解析该代码时，默认会转译为严格模式，也就会在转译时就抛出此类错误。</p> <p>如果调整转译配置:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>babel<span class="token punctuation">.</span><span class="token function">transformSync</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">parserOpts</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">strictMode</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// striceMode 默认是 true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>那么在转译时就不会抛错了。</p></li> <li><p>非严格模式下，函数必须声明在顶层作用域、块级作用域或者作为 <code>if</code> 语句的 <code>body</code> 区域</p> <p><code>Errors.SloppyFunction</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>In non-strict mode code, functions can only be declared at <span class="token function">top</span> level, inside a block, or as the body of an <span class="token keyword">if</span> statement.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这些写法都是合法的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>另外，在 <code>statement.js</code> 中，也允许函数声明出现在标签语句中，即: <code>label: function run() {}</code></p> <p>但这样的写法是不合法的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>TODO</p> <p><code>Errors.UnexpectedLexicalDeclaration</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Lexical declaration cannot appear <span class="token keyword">in</span> a single-statement context.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以下案例中:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个案例的转译报错并不是这个，而是 <code>Unexpected reserved word 'let'</code>。</p></li> <li><p><code>import</code> 和 <code>export</code> 必须出现在顶层作用域。</p> <p><code>Errors.UnexpectedImportExport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'import'</span> and <span class="token string">'export'</span> may only appear at the <span class="token function">top</span> level.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在转译时就会抛出以下错误:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token string">'import'</span> and <span class="token string">'export'</span> may only appear at the <span class="token function">top</span> level. <span class="token punctuation">(</span><span class="token number">2</span>:4<span class="token punctuation">)</span>

<span class="token number">1</span> <span class="token operator">|</span> <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
    <span class="token operator">|</span>     ^
<span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>async</code> 标记的函数必须定义在顶层作用域或块级作用域</p> <p><code>Errors.AsyncFunctionInSingleStatementContext</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Async functions can only be declared at the <span class="token function">top</span> level or inside a block.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这种写法的源码在转译时会触发该报错:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>装饰器必须作用于类的声明中</p> <p><code>Errors.UnexpectedLeadingDecorator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Leading decorators must be attached to a class declaration.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>举例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>@track greeting <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Leading decorators must be attached to a class declaration. <span class="token punctuation">(</span><span class="token number">1</span>:7<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> @track greeting <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>        ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>非法的 <code>break</code> 或 <code>continue</code></p> <p><code>Errors.IllegalBreakContinue</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unsyntactic %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>表示非法的 <code>break</code> 或 <code>continue</code>。这两个词法单元只会作用于循环，如果没有写在循环里，转译时就会发现并且报错。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会报错 <code>Unsyntactic break</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会报错 <code>Unsyntactic continue</code>。</p></li> <li><p><code>Errors.ForOfLet</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>The left-hand side of a for-of loop may not start with <span class="token string">'let'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.ForOfAsync</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>The left-hand side of a for-of loop may not be <span class="token string">'async'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p>非法的 <code>return</code></p> <p><code>Errors.IllegalReturn</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'return'</span> outside of function.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>转译时，函数体外出现了 <code>return</code> 会抛出此错误。</p> <p>比如:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但如果这样配置，就允许函数体外出现 <code>return</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>babel<span class="token punctuation">.</span><span class="token function">transformSync</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">parserOpts</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">allowReturnOutsideFunction</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>switch</code> 语句中是否有多余的 <code>default</code></p> <p><code>Errors.MultipleDefaultsInSwitch</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Multiple default clauses.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">switch</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'Jack'</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>throw</code> 不允许出现换行符</p> <p><code>Errors.NewlineAfterThrow</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Illegal newline after throw.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">throw</span>
<span class="token string">'error'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><code>Errors.NoCatchOrFinally</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Missing catch or finally clause.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><code>Errors.StrictWith</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'with'</span> <span class="token keyword">in</span> strict mode.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>
<span class="token keyword">with</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><code>Errors.LabelRedeclaration</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Label <span class="token string">'%0'</span> is already declared.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.ForInOfLoopInitializer</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'%0'</span> loop variable declaration may not have an initializer.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> iterable <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">50</span> <span class="token keyword">of</span> iterable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>转译时会抛出错误:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'for-of'</span> loop variable declaration may not have an initializer. <span class="token punctuation">(</span><span class="token number">3</span>:5<span class="token punctuation">)</span>

<span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">let</span> iterable <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span>, <span class="token number">20</span>, <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>let value <span class="token operator">=</span> <span class="token number">50</span> of iterable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span>      ^
<span class="token number">4</span> <span class="token operator">|</span>   console.log<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>Errors.InvalidLhs</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid left-hand side <span class="token keyword">in</span> %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Invalid left-hand side <span class="token keyword">in</span> assignment expression. <span class="token punctuation">(</span><span class="token number">1</span>:0<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token operator">|</span> ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.DeclarationMissingInitializer</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'%0'</span> require an initialization value.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> x<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token string">'Const declarations'</span> require an initialization value. <span class="token punctuation">(</span><span class="token number">1</span>:7<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> const x<span class="token punctuation">;</span>
    <span class="token operator">|</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.GeneratorInSingleStatementContext</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Generators can only be declared at the <span class="token function">top</span> level or inside a block.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>已知，在非严格模式下，这样的写法是合法的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但 Generator 函数例外，这样的写法是非法的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.DecoratorSemicolon</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Decorators must not be followed by a semicolon.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">XXX</span> <span class="token punctuation">{</span>
    @<span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 这是伪代码</span>
babel<span class="token punctuation">.</span><span class="token function">transformSync</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'babel-plugin-proposal-decorators'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">decoratorsBeforeExport</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">SyntaxError</span><span class="token operator">:</span> unknown<span class="token operator">:</span> Decorators must not be followed by a semicolon<span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     @<span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>                <span class="token operator">^</span>
  <span class="token number">3</span> <span class="token operator">|</span>     <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token number">4</span> <span class="token operator">|</span>         <span class="token comment">//</span>
  <span class="token number">5</span> <span class="token operator">|</span>     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>Errors.TrailingDecorator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Decorators must be attached to a class element.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>@on name <span class="token operator">=</span><span class="token string">'Jack'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Leading decorators must be attached to a class declaration. <span class="token punctuation">(</span><span class="token number">2</span>:7<span class="token punctuation">)</span>

<span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span> @track greeting <span class="token operator">=</span><span class="token string">'World'</span><span class="token punctuation">;</span>
    <span class="token operator">|</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>Errors.ConstructorIsGenerator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Constructor can't be a generator.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Constructor can't be a generator. <span class="token punctuation">(</span><span class="token number">2</span>:6<span class="token punctuation">)</span>

<span class="token number">1</span> <span class="token operator">|</span> class Test <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     * <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token operator">|</span>       ^
<span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>Errors.DuplicateConstructor</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Duplicate constructor <span class="token keyword">in</span> the same class.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Duplicate constructor <span class="token keyword">in</span> the same class. <span class="token punctuation">(</span><span class="token number">3</span>:4<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> class Test <span class="token punctuation">{</span>
  <span class="token number">2</span> <span class="token operator">|</span>     <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">|</span>     <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token operator">|</span>     ^
  <span class="token number">4</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>Errors.OverrideOnConstructor</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'override'</span> modifier cannot appear on a constructor declaration.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.ConstructorIsAsync</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Constructor can't be an async function.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Constructor can't be an async function. <span class="token punctuation">(</span><span class="token number">2</span>:10<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> class Test <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     async <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token operator">|</span>           ^
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>Errors.ConstructorIsAccessor</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Class constructor may not be an accessor.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.StaticPrototype</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Classes may not have static property named prototype.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">X</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> prototype<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Classes may not have static property named prototype. <span class="token punctuation">(</span><span class="token number">2</span>:11<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> class X <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     static prototype<span class="token punctuation">;</span>
    <span class="token operator">|</span>            ^
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>Errors.ConstructorClassPrivateField</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Classes may not have a private field named <span class="token string">'#constructor'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token function">#constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Classes may not have a private field named <span class="token string">'#constructor'</span><span class="token builtin class-name">.</span> <span class="token punctuation">(</span><span class="token number">2</span>:4<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> class Test <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     <span class="token comment">#constructor() {}</span>
    <span class="token operator">|</span>     ^
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>Errors.DecoratorStaticBlock</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Decorators can't be used with a static block.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">X</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    @<span class="token function">decorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Decorators can't be used with a static block. <span class="token punctuation">(</span><span class="token number">6</span>:4<span class="token punctuation">)</span>

  <span class="token number">4</span> <span class="token operator">|</span>     <span class="token punctuation">}</span>
  <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">&gt;</span> <span class="token number">6</span> <span class="token operator">|</span>     @decorator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>     ^
  <span class="token number">7</span> <span class="token operator">|</span>     static <span class="token punctuation">{</span>
  <span class="token number">8</span> <span class="token operator">|</span>
  <span class="token number">9</span> <span class="token operator">|</span>     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><code>Errors.ConstructorClassField</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Classes may not have a field named <span class="token string">'constructor'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">X</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">constructor</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Classes may not have a field named <span class="token string">'constructor'</span><span class="token builtin class-name">.</span> <span class="token punctuation">(</span><span class="token number">2</span>:4<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> class X <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     constructor <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span>     ^
  <span class="token number">3</span> <span class="token operator">|</span>
  <span class="token number">4</span> <span class="token operator">|</span>     <span class="token punctuation">}</span>
  <span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>Errors.DecoratorBeforeExport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Decorators must be placed *before* the <span class="token string">'export'</span> keyword. You can <span class="token builtin class-name">set</span> the <span class="token string">'decoratorsBeforeExport'</span> option to <span class="token boolean">false</span> to use the <span class="token string">'export @decorator class {}'</span> syntax.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> @decorator <span class="token keyword">class</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> @decorator class <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token operator">|</span>        ^
  <span class="token number">2</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><code>Errors.UnsupportedDefaultExport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Only expressions, functions or classes are allowed as the <span class="token variable"><span class="token variable">`</span>default<span class="token variable">`</span></span> export.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Only expressions, functions or classes are allowed as the <span class="token variable"><span class="token variable">`</span>default<span class="token variable">`</span></span> export. <span class="token punctuation">(</span><span class="token number">1</span>:15<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> default const x <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token operator">|</span>                ^
  <span class="token number">2</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>Errors.ExportDefaultFromAsIdentifier</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'from'</span> is not allowed as an identifier after <span class="token string">'export default'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> from <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> from<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token string">'from'</span> is not allowed as an identifier after <span class="token string">'export default'</span><span class="token builtin class-name">.</span> <span class="token punctuation">(</span><span class="token number">2</span>:15<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> const from <span class="token operator">=</span> <span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> default from<span class="token punctuation">;</span>
    <span class="token operator">|</span>                ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>Errors.ExportBindingIsString</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>A string literal cannot be used as an exported binding without <span class="token variable"><span class="token variable">`</span>from<span class="token variable">`</span></span>.<span class="token punctuation">\</span>n- Did you mean <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">export</span> <span class="token punctuation">{</span> <span class="token string">'%0'</span> as <span class="token string">'%1'</span> <span class="token punctuation">}</span> from <span class="token string">'some-module'</span><span class="token variable">`</span></span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.UnsupportedDecoratorExport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>A decorated <span class="token builtin class-name">export</span> must <span class="token builtin class-name">export</span> a class declaration.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.DuplicateDefaultExport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Only one default <span class="token builtin class-name">export</span> allowed per module.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> x
<span class="token keyword">export</span> <span class="token keyword">default</span> y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Only one default <span class="token builtin class-name">export</span> allowed per module. <span class="token punctuation">(</span><span class="token number">2</span>:0<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> default x
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> default y
    <span class="token operator">|</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>Errors.DuplicateExport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token variable"><span class="token variable">`</span>%0<span class="token variable">`</span></span> has already been exported. Exported identifiers must be unique.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
    <span class="token operator">|</span>          ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><code>Errors.ModuleExportNameHasLoneSurrogate</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>An <span class="token builtin class-name">export</span> name cannot include a lone surrogate, found <span class="token string">'\\u%0'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.ModuleAttributesWithDuplicateKeys</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Duplicate key <span class="token string">&quot;%0&quot;</span> is not allowed <span class="token keyword">in</span> module attributes.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.ModuleAttributeDifferentFromType</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>The only accepted module attribute is <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">type</span><span class="token variable">`</span></span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.DestructureNamedImport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ES2015 named imports <span class="token keyword">do</span> not destructure. Use another statement <span class="token keyword">for</span> destructuring after the import.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.ImportBindingIsString</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>A string literal cannot be used as an imported binding.<span class="token punctuation">\</span>n- Did you mean <span class="token variable"><span class="token variable">`</span><span class="token function">import</span> <span class="token punctuation">{</span> <span class="token string">&quot;%0&quot;</span> as foo <span class="token punctuation">}</span><span class="token variable">`</span></span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>SourceTypeModuleErrors.ImportOutsideModule</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'import'</span> and <span class="token string">'export'</span> may appear only with <span class="token string">'sourceType: &quot;module&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token string">'import'</span> and <span class="token string">'export'</span> may appear only with <span class="token string">'sourceType: &quot;module&quot;'</span> <span class="token punctuation">(</span><span class="token number">1</span>:0<span class="token punctuation">)</span>
Consider renaming the <span class="token function">file</span> to <span class="token string">'.mjs'</span>, or setting sourceType:module or sourceType:unambiguous <span class="token keyword">in</span> your Babel config <span class="token keyword">for</span> this file.

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">export</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
    <span class="token operator">|</span> ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h4 id="表达式类错误-expression-js"><a href="#表达式类错误-expression-js" class="header-anchor">#</a> 表达式类错误（<code>expression.js</code>）</h4> <ul><li><p><code>SourceTypeModuleErrors.ImportMetaOutsideModule</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>import.meta may appear only with <span class="token string">'sourceType: &quot;module&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token string">'import.meta'</span>

 babel<span class="token punctuation">.</span><span class="token function">transformSync</span><span class="token punctuation">(</span><span class="token string">'import.meta'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
     <span class="token literal-property property">parserOpts</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">'script'</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: import.meta may appear only with <span class="token string">'sourceType: &quot;module&quot;'</span> <span class="token punctuation">(</span><span class="token number">1</span>:0<span class="token punctuation">)</span>
Consider renaming the <span class="token function">file</span> to <span class="token string">'.mjs'</span>, or setting sourceType:module or sourceType:unambiguous <span class="token keyword">in</span> your Babel config <span class="token keyword">for</span> this file.

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> import.meta
    <span class="token operator">|</span> ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>Errors.RecordNoProto</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'__proto__'</span> is not allowed <span class="token keyword">in</span> Record expressions.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.DuplicateProto</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Redefinition of __proto__ property.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.UnexpectedAwaitAfterPipelineBody</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected <span class="token string">&quot;await&quot;</span> after pipeline body<span class="token punctuation">;</span> await must have parentheses <span class="token keyword">in</span> minimal proposal.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.MixingCoalesceWithLogical</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Nullish coalescing operator<span class="token punctuation">(</span>??<span class="token punctuation">)</span> requires parens when mixing with logical operators.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TODO</p></li> <li><p><code>Errors.UnexpectedTokenUnaryExponentiation</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Illegal expression. Wrap left hand side or entire exponentiation <span class="token keyword">in</span> parentheses.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.StrictDelete</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Deleting <span class="token builtin class-name">local</span> variable <span class="token keyword">in</span> strict mode.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.DeletePrivateField</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Deleting a private field is not allowed.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.SuperPrivateField</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Private fields can't be accessed on super.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.OptionalChainingNoTemplate</code></p> <p>https://github.com/tc39/proposal-optional-chaining/issues/54</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Tagged Template Literals are not allowed <span class="token keyword">in</span> optionalChain.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.ImportCallArity</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'import()'</span> requires exactly %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token variable"><span class="token variable">`</span>import<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">`</span></span> requires exactly one argument. <span class="token punctuation">(</span><span class="token number">1</span>:0<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> import<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.ImportCallSpreadArgument</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'...'</span> is not allowed <span class="token keyword">in</span> <span class="token string">'import()'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token operator">...</span>x<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token variable"><span class="token variable">`</span><span class="token punctuation">..</span>.<span class="token variable">`</span></span> is not allowed <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span>import<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">`</span></span><span class="token builtin class-name">.</span> <span class="token punctuation">(</span><span class="token number">1</span>:7<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> import<span class="token punctuation">(</span><span class="token punctuation">..</span>.x<span class="token punctuation">)</span>
    <span class="token operator">|</span>        ^
  <span class="token number">2</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>Errors.ImportCallArgumentTrailingComma</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Trailing comma is disallowed inside import<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span> arguments.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./x.js'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Trailing comma is disallowed inside import<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span> arguments. <span class="token punctuation">(</span><span class="token number">1</span>:15<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> import<span class="token punctuation">(</span><span class="token string">'./x.js'</span>, <span class="token punctuation">)</span>
    <span class="token operator">|</span>                ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.UnsupportedImport</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'import'</span> can only be used <span class="token keyword">in</span> <span class="token string">'import()'</span> or <span class="token string">'import.meta'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnsupportedBind</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Binding should be performed on object property.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.PrivateInExpectedIn</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Private names are only allowed <span class="token keyword">in</span> property accesses <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>obj.<span class="token comment">#%0</span><span class="token variable">`</span></span><span class="token punctuation">)</span> or <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token keyword">in</span><span class="token variable">`</span></span> expressions <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token comment">#%0 in obj</span><span class="token variable">`</span></span><span class="token punctuation">)</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.PrimaryTopicRequiresSmartPipeline</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Primary Topic Reference found but pipelineOperator not passed <span class="token string">'smart'</span> <span class="token keyword">for</span> <span class="token string">'proposal'</span> option.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.PrimaryTopicNotAllowed</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Topic reference was used <span class="token keyword">in</span> a lexical context without topic binding.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.LineTerminatorBeforeArrow</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>No line <span class="token builtin class-name">break</span> is allowed before <span class="token string">'=&gt;'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnsupportedSuper</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'super'</span> can only be used with <span class="token keyword">function</span> calls <span class="token punctuation">(</span>i.e. super<span class="token punctuation">(</span><span class="token punctuation">))</span> or <span class="token keyword">in</span> property accesses <span class="token punctuation">(</span>i.e. super.prop or super<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>示例1:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token variable"><span class="token variable">`</span>super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">`</span></span> is only valid inside a class constructor of a subclass. Maybe a typo <span class="token keyword">in</span> the method name <span class="token punctuation">(</span><span class="token string">'constructor'</span><span class="token punctuation">)</span> or not extending another class? <span class="token punctuation">(</span><span class="token number">1</span>:0<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> super<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> ^
  <span class="token number">2</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>示例2:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Run</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token variable"><span class="token variable">`</span>super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">`</span></span> is only valid inside a class constructor of a subclass. Maybe a typo <span class="token keyword">in</span> the method name <span class="token punctuation">(</span><span class="token string">'constructor'</span><span class="token punctuation">)</span> or not extending another class? <span class="token punctuation">(</span><span class="token number">4</span>:12<span class="token punctuation">)</span>

  <span class="token number">2</span> <span class="token operator">|</span>     <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token number">3</span> <span class="token operator">|</span>         <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token operator">|</span>             super<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>             ^
  <span class="token number">5</span> <span class="token operator">|</span>         <span class="token punctuation">}</span>
  <span class="token number">6</span> <span class="token operator">|</span>     <span class="token punctuation">}</span>
  <span class="token number">7</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><code>Errors.UnexpectedPrivateField</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Private names can only be used as the name of a class element 
<span class="token punctuation">(</span>i.e. <span class="token string">&quot;class C { #p = 42; #m() {} }&quot;</span><span class="token punctuation">)</span> 
or 
a property of member expression <span class="token punctuation">(</span>i.e. <span class="token string">&quot;this.#p&quot;</span><span class="token punctuation">)</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    #name<span class="token operator">:</span> <span class="token string">'Jack'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  <span class="token number">1</span> <span class="token operator">|</span> const obj <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     <span class="token comment">#name: 'Jack'</span>
    <span class="token operator">|</span>      ^
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.UnsupportedMetaProperty</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>The only valid meta property <span class="token keyword">for</span> %0 is %0.%1.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">.</span>name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: The only valid meta property <span class="token keyword">for</span> <span class="token function">import</span> is import.meta. <span class="token punctuation">(</span><span class="token number">1</span>:7<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> import.name
    <span class="token operator">|</span>        ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.UnexpectedNewTarget</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">&quot;new.target&quot;</span> can only be used <span class="token keyword">in</span> functions or class properties.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span><span class="token punctuation">.</span>target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token variable"><span class="token variable">`</span>new.target<span class="token variable">`</span></span> can only be used <span class="token keyword">in</span> functions or class properties. <span class="token punctuation">(</span><span class="token number">1</span>:0<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> new.target
    <span class="token operator">|</span> ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.ImportCallNotNewExpression</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Cannot use new with import<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">import</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Cannot use new with import<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>. <span class="token punctuation">(</span><span class="token number">1</span>:4<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> new import<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token operator">|</span>     ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.OptionalChainingNoNew</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Constructors in/after an Optional Chain are not allowed.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> man <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">person</span><span class="token operator">?.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Constructors in/after an Optional Chain are not allowed. <span class="token punctuation">(</span><span class="token number">7</span>:28<span class="token punctuation">)</span>

  <span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">&gt;</span> <span class="token number">7</span> <span class="token operator">|</span> const <span class="token function">man</span> <span class="token operator">=</span> new person?.name<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>Errors.InvalidEscapeSequenceTemplate</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid escape sequence <span class="token keyword">in</span> template.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.InvalidRecordProperty</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Only properties and spread elements are allowed <span class="token keyword">in</span> record definitions.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnsupportedPropertyDecorator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Decorators cannot be used to decorate object literal properties.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.AccessorIsGenerator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>A %0ter cannot be a generator.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.BadSetterRestParameter</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>A <span class="token string">'set'</span> accesor <span class="token keyword">function</span> argument must not be a rest parameter.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.IllegalLanguageModeDirective</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Illegal <span class="token string">'use strict'</span> directive <span class="token keyword">in</span> <span class="token keyword">function</span> with non-simple parameter list.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnexpectedToken</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected token <span class="token string">'%0'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnexpectedArgumentPlaceholder</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected argument placeholder.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.YieldBindingIdentifier</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Can not use <span class="token string">'yield'</span> as identifier inside a generator.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">yield</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  <span class="token number">1</span> <span class="token operator">|</span> const run <span class="token operator">=</span> function* <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     const yield <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>           ^
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.AwaitBindingIdentifier</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Can not use <span class="token string">'await'</span> as identifier inside an async function.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">await</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  <span class="token number">2</span> <span class="token operator">|</span> const run <span class="token operator">=</span> async <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">|</span>     const await <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>           ^
  <span class="token number">4</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.AwaitBindingIdentifierInStaticBlock</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Can not use <span class="token string">'await'</span> as identifier inside a static block.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.ArgumentsInClass</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'arguments'</span> is only allowed <span class="token keyword">in</span> functions and class methods.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnexpectedKeyword</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected keyword <span class="token string">'%0'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnexpectedReservedWord</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected reserved word <span class="token string">'%0'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.ObsoleteAwaitStar</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'await*'</span> has been removed from the async functions proposal. Use Promise.all<span class="token punctuation">(</span><span class="token punctuation">)</span> instead.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.PipelineHeadSequenceExpression</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Pipeline <span class="token function">head</span> should not be a comma-separated sequence expression.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.PipelineBodySequenceExpression</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Pipeline body may not be a comma-separated sequence expression.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.PipelineTopicUnused</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Pipeline is <span class="token keyword">in</span> topic style but does not use topic reference.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="左值类错误-lval-js"><a href="#左值类错误-lval-js" class="header-anchor">#</a> 左值类错误（<code>lval.js</code>）</h4> <ul><li><p><code>Errors.InvalidParenthesizedAssignment</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid parenthesized assignment pattern.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Invalid parenthesized assignment pattern. <span class="token punctuation">(</span><span class="token number">1</span>:13<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> const <span class="token function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a, b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token builtin class-name">return</span> a + b<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>              ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.MissingEqInAssignment</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Only <span class="token string">'='</span> operator can be used <span class="token keyword">for</span> specifying default value.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnsupportedParameterDecorator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Decorators cannot be used to decorate parameters.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token parameter">@MyDecorator myArg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Decorators cannot be used to decorate parameters. <span class="token punctuation">(</span><span class="token number">2</span>:15<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> class MyClass <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     myFunction<span class="token punctuation">(</span>@MyDecorator myArg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">|</span>                ^
  <span class="token number">3</span> <span class="token operator">|</span>         
  <span class="token number">4</span> <span class="token operator">|</span>     <span class="token punctuation">}</span>
  <span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>Errors.ParamDupe</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Argument name clash.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Argument name clash. <span class="token punctuation">(</span><span class="token number">1</span>:18<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">function</span> run<span class="token punctuation">(</span>req, req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span>                   ^
  <span class="token number">2</span> <span class="token operator">|</span>     
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">4</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>Errors.LetInLexicalBinding</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">'let'</span> is not allowed to be used as a name <span class="token keyword">in</span> <span class="token string">'let'</span> or <span class="token string">'const'</span> declarations.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token keyword">let</span> <span class="token operator">=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: <span class="token string">'let'</span> is not allowed to be used as a name <span class="token keyword">in</span> <span class="token string">'let'</span> or <span class="token string">'const'</span> declarations. <span class="token punctuation">(</span><span class="token number">1</span>:4<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token builtin class-name">let</span> <span class="token builtin class-name">let</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token operator">|</span>     ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.InvalidPropertyBindingPattern</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Binding member expression.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.InvalidLhs</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid left-hand side <span class="token keyword">in</span> %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span> x <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Invalid left-hand side <span class="token keyword">in</span> assignment expression. <span class="token punctuation">(</span><span class="token number">1</span>:4<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> if<span class="token punctuation">(</span> x <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span>     ^
  <span class="token number">2</span> <span class="token operator">|</span>     
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">4</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>Errors.InvalidLhsBinding</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Binding invalid left-hand side <span class="token keyword">in</span> %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a <span class="token operator">-</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Binding invalid left-hand side <span class="token keyword">in</span> <span class="token keyword">function</span> parameter list. <span class="token punctuation">(</span><span class="token number">1</span>:12<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> data1.sort<span class="token punctuation">((</span>a - b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span>             ^
  <span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> a.count - b.count
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token number">4</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>Errors.InvalidRestAssignmentPattern</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid rest operator's argument.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.ElementAfterRest</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Rest element must be last element.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token operator">...</span>param1<span class="token punctuation">,</span> param2 <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Rest element must be last element. <span class="token punctuation">(</span><span class="token number">1</span>:15<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> const run <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">..</span>.param1, param2 <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token operator">|</span>                ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>Errors.RestTrailingComma</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected trailing comma after rest element.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">...</span>c<span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Unexpected trailing comma after rest element. <span class="token punctuation">(</span><span class="token number">1</span>:18<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> const <span class="token punctuation">[</span> a, b, <span class="token punctuation">..</span>.c, <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>                   ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h4 id="作用域类错误"><a href="#作用域类错误" class="header-anchor">#</a> 作用域类错误</h4> <ul><li><p><code>class-scope.js</code></p> <ul><li><p><code>Errors.InvalidPrivateFieldResolution</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Private name <span class="token comment">#%0 is not defined.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.PrivateNameRedeclaration</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Duplicate private name <span class="token comment">#%0.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p><code>scope.js</code></p> <ul><li><p><code>Errors.VarRedeclaration</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Identifier <span class="token string">'%0'</span> has already been declared.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Identifier <span class="token string">'x'</span> has already been declared. <span class="token punctuation">(</span><span class="token number">2</span>:6<span class="token punctuation">)</span>

<span class="token number">1</span> <span class="token operator">|</span> const x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span> const x <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token operator">|</span>       ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li></ul> <h4 id="jsx-类错误"><a href="#jsx-类错误" class="header-anchor">#</a> jsx 类错误</h4> <ul><li><p><code>ErrorCodes.SyntaxError</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>BABEL_PARSER_SYNTAX_ERROR
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Errors.UnterminatedString</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unterminated string constant.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> 'Jack&quot;
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Unterminated string constant. <span class="token punctuation">(</span><span class="token number">2</span>:11<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">function</span> <span class="token function-name function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> 'Jack&quot;
    <span class="token operator">|</span>            ^
  <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">4</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>JsxErrors.UnterminatedJsxContent</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unterminated JSX contents.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>  
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Unterminated JSX contents. <span class="token punctuation">(</span><span class="token number">3</span>:13<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">function</span> <span class="token function-name function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>  
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">|</span>         <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">|</span>              ^
  <span class="token number">4</span> <span class="token operator">|</span>     <span class="token punctuation">)</span>
  <span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">6</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><code>JsxErrors.AttributeIsEmpty</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>JSX attributes must only be assigned a non-empty expression.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>  
        <span class="token operator">&lt;</span>div title<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: JSX attributes must only be assigned a non-empty expression. <span class="token punctuation">(</span><span class="token number">3</span>:19<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">function</span> <span class="token function-name function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>  
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">|</span>         <span class="token operator">&lt;</span>div <span class="token assign-left variable">title</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
    <span class="token operator">|</span>                    ^
  <span class="token number">4</span> <span class="token operator">|</span>     <span class="token punctuation">)</span>
  <span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">6</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><code>JsxErrors.UnsupportedJsxValue</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>JSX value should be either an expression or a quoted JSX text.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>  
        <span class="token operator">&lt;</span>div title<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: JSX value should be either an expression or a quoted JSX text. <span class="token punctuation">(</span><span class="token number">3</span>:19<span class="token punctuation">)</span>

  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">function</span> <span class="token function-name function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>  
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">|</span>         <span class="token operator">&lt;</span>div <span class="token assign-left variable">title</span><span class="token operator">=</span>true<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
    <span class="token operator">|</span>                    ^
  <span class="token number">4</span> <span class="token operator">|</span>     <span class="token punctuation">)</span>
  <span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">6</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><code>JsxErrors.UnexpectedSequenceExpression</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Sequence expressions cannot be directly nested inside JSX. Did you mean to wrap it <span class="token keyword">in</span> parentheses <span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>JsxErrors.MissingClosingTagFragment</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Expected corresponding JSX closing tag <span class="token keyword">for</span> <span class="token operator">&lt;&gt;</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>JsxErrors.UnwrappedAdjacentJSXElements</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Adjacent JSX elements must be wrapped <span class="token keyword">in</span> an enclosing tag. Did you want a JSX fragment <span class="token operator">&lt;&gt;</span><span class="token punctuation">..</span>.<span class="token operator">&lt;</span>/<span class="token operator">&gt;</span>?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>  
        <span class="token operator">&lt;</span>Comp1 <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Comp2 <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: Adjacent JSX elements must be wrapped <span class="token keyword">in</span> an enclosing tag. Did you want a JSX fragment <span class="token operator">&lt;&gt;</span><span class="token punctuation">..</span>.<span class="token operator">&lt;</span>/<span class="token operator">&gt;</span>? <span class="token punctuation">(</span><span class="token number">4</span>:8<span class="token punctuation">)</span>

  <span class="token number">2</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>  
  <span class="token number">3</span> <span class="token operator">|</span>         <span class="token operator">&lt;</span>Comp1 /<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token operator">|</span>         <span class="token operator">&lt;</span>Comp2 /<span class="token operator">&gt;</span>
    <span class="token operator">|</span>         ^
  <span class="token number">5</span> <span class="token operator">|</span>     <span class="token punctuation">)</span>
  <span class="token number">6</span> <span class="token operator">|</span> <span class="token punctuation">}</span>
  <span class="token number">7</span> <span class="token operator">|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <h3 id="特定语法开关"><a href="#特定语法开关" class="header-anchor">#</a> 特定语法开关</h3> <p>Babel 并不会开启对所有语法特性的转译，这也是出于性能的考虑。</p> <p>在源码中，和&quot;语法开关&quot;相关的代码主要是文件 <code>babel/packages/babel-parser/src/parser/util.js</code> 定义的方法:</p> <ul><li><code>expectPlugin(pluginName)</code>: 检测某个插件是否被配置，如果没有会抛出错误</li> <li><code>getPluginOption()</code>: 获取插件的配置项</li></ul> <p>以下特性默认不会开启，关于每个特性的详细介绍，可查看章节&quot;Babel 内置插件&quot;了解，下表中插件名称均以源码文件命名为准。</p> <ul><li><p><code>pipelineOperator</code></p> <p>语法插件: <code>babel-plugin-syntax-pipeline-operator</code></p> <p>转换插件: <code>babel-plugin-proposal-pipeline-operator</code></p> <p>开启对 <code>pipelineOperator</code> 语法的支持，也就是 <code>|&gt;</code> 写法。</p></li> <li><p><code>throwExpressions</code></p> <p>语法插件: <code>babel-plugin-syntax-throw-expressions</code></p> <p>转换插件: <code>babel-plugin-proposal-throw-expressions</code></p> <p>开启对 <code>throwExpressions</code> 的语法支持。</p> <p>举例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span>filename <span class="token operator">=</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Argument required&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>importAssertions</code></p> <p>语法插件: <code>babel-plugin-syntax-import-assertions</code></p> <p>开启对 <code>Import assertions</code> 语法的支持。</p> <p>该语法主要是为了更清晰地描述模块的一些特性信息，比如类型。</p> <p>举个例子，引入 <code>./config.json</code> 文件时，声明其内容类型为 json，有几种写法：</p> <ul><li><p>静态 import</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'./config.json'</span> <span class="token keyword">assert</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>动态 import</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./config.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">assert</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>export</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> config <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./config.json'</span> <span class="token keyword">assert</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'json'</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p><code>privateIn</code></p> <p>语法插件: <code>babel-plugin-syntax-private-property-in-object</code></p> <p>转换插件: <code>babel-plugin-proposal-private-property-in-object</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    #bar <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> #bar <span class="token keyword">in</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>doExpressions</code></p> <p>语法插件: <code>babel-plugin-syntax-do-expressions</code></p> <p>转换插件: <code>babel-plugin-proposal-do-expression</code></p> <p>开启对 <code>do</code> 表达式语法的支持。<code>do</code> 表示可以认为是三元表达式的变种，在较复杂的情况下加，用 <code>do</code> 表达式更简洁。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token string">'big x, big y'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token string">'big x, small y'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token string">'small x, big y'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token string">'small x, small y'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p><code>functionSent</code></p> <p>语法插件: <code>babel-plugin-syntax-function-sent</code></p> <p>转换插件: <code>babel-plugin-proposal-function-sent</code></p> <p>开启对 <code>functionSent</code> 语法的支持，即开启对 <code>function.sent</code> 的语法支持。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sent&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">.</span>sent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Yield&quot;</span><span class="token punctuation">,</span> <span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs &quot;Sent 1&quot;</span>
iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs &quot;Yield 2&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>recordAndTuple</code></p> <p>语法插件: <code>babel-plugin-syntax-record-and-tuple</code></p> <p>开启对 <code>recordAndTuple</code> 语法的支持，对应的是 <code>proposal-record-tuple</code> 提案。</p></li> <li><p><code>partialApplication</code></p> <p>语法插件: <code>babel-plugin-syntax-partial-application</code></p> <p>转换插件: <code>babel-plugin-proposal-partial-application</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">)</span>           <span class="token comment">// partial application from left</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>           <span class="token comment">// partial application from right</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">)</span>        <span class="token comment">// partial application for any arg</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><code>moduleBlocks</code></p> <p>语法插件: <code>babel-plugin-syntax-module-blocks</code></p> <p>开启对 <code>moduleBlocks</code> 语法的支持。</p> <p><code>moduleBlocks</code> 语法简介如下(案例来自tc39)：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> moduleBlock <span class="token operator">=</span> module <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> moduleExports <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>moduleBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>moduleExports<span class="token punctuation">.</span>y <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>moduleBlock<span class="token punctuation">)</span> <span class="token operator">===</span> moduleExports<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// cached in the module map</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这样，提供了非文件的方式引入模块。</p> <p>且 <code>moduleBlocks</code> 只能被 <code>import()</code> 引入，而非 <code>import</code> 表达式。</p></li> <li><p><code>classStaticBlock</code></p> <p>语法插件: <code>babel-plugin-syntax-class-static-block</code></p> <p>转换插件: <code>babel-plugin-proposal-class-static-block</code></p> <p>转换class类中的静态block。</p> <p>下例来自Babel官网：</p> <blockquote><p>下例的转换需要在该插件前引入插件 babel-plugin-proposal-class-properties，也就是支持对 <code>class</code> 属性的语法支持和代码转换。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> #x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> y<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">doSomethingWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p><code>classPrivateProperties</code></p> <p>语法插件: <code>babel-plugin-syntax-class-properties</code></p> <p>转换插件: <code>babel-plugin-proposal-class-properties</code></p> <p>开启对类的属性(<code>classProperties</code>)、私有属性(<code>classPrivateProperties</code>)、私有方法(<code>classPrivateMethods</code>)的语法支持。</p> <p>举例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token punctuation">{</span>
    <span class="token comment">// 属性</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Jack'</span><span class="token punctuation">,</span>

    <span class="token comment">// 私有属性</span>
    <span class="token keyword">private</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>

    <span class="token comment">// 私有方法</span>
    <span class="token keyword">private</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p><code>classPrivateMethods</code></p> <p>语法插件: <code>plugin-syntax-class-properties</code></p> <p>转换插件: <code>babel-plugin-proposal-private-methods</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
   #xValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

   <span class="token keyword">get</span> <span class="token function">#x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#xValue<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">set</span> <span class="token function">#x</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>#xValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p><code>classProperties</code></p> <p>语法插件: <code>babel-plugin-syntax-class-properties</code></p> <p>转换插件: <code>babel-plugin-proposal-class-properties</code></p> <p>转换 class 中的原型和静态属性/方法。</p> <p>下例来自 Babel 官网。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Bork</span> <span class="token punctuation">{</span>
    <span class="token comment">// Property initializer syntax</span>
    instanceProperty <span class="token operator">=</span> <span class="token string">&quot;bork&quot;</span><span class="token punctuation">;</span>
    <span class="token function-variable function">boundFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceProperty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Static class properties</span>
    <span class="token keyword">static</span> staticProperty <span class="token operator">=</span> <span class="token string">&quot;babelIsCool&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token function-variable function">staticFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Bork<span class="token punctuation">.</span>staticProperty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p><code>exportDefaultFrom</code></p> <p>语法插件: <code>babel-plugin-syntax-export-default-from</code></p> <p>转换插件: <code>babel-plugin-proposal-export-default-from</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> v <span class="token keyword">from</span> <span class="token string">&quot;mod&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>moduleStringNames</code></p> <p>语法插件: <code>babel-plugin-syntax-module-string-names</code></p> <p>开启对 <code>moduleStringNames</code> 语法的支持，也就是模块别名的支持。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> hi <span class="token keyword">as</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./hi.js'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>moduleAttributes</code></p></li> <li><p><code>decimal</code></p> <p>语法插件: <code>babel-plugin-syntax-demical</code></p></li></ul> <h1 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h1> <p>TODO</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/hoperyy/deep-in-babel/edit/main/02.转译原理/index.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <!----> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/deep-in-babel/assets/js/app.0ba590d3.js" defer></script><script src="/deep-in-babel/assets/js/vendors~layout-Layout.f8963aab.js" defer></script><script src="/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.ebefd1c7.js" defer></script><script src="/deep-in-babel/assets/js/page--6ea6aa74.9343547a.js" defer></script><script src="/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.33005620.js" defer></script>
  </body>
</html>
